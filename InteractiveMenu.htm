<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laugar Cafe Interactive Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f87171; /* Tailwind Red-400 */
            --secondary: #1f2937; /* Tailwind Gray-800 */
            --background: #f9fafb; /* Tailwind Gray-50 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
        }
        .theme-filter-button {
            transition: all 0.2s;
            cursor: pointer;
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            font-weight: 600;
        }
        .theme-filter-button:hover:not(.active) {
            background-color: #fecaca; /* Red-200 */
            color: var(--secondary);
        }
        .theme-filter-button.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .item-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .size-button {
            padding: 0.25rem 0.6rem;
            border-radius: 0.5rem;
            transition: all 0.15s;
            cursor: pointer;
        }
        .size-button.active {
            background-color: #f87171; /* Red-400 */
            color: white;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        
        <header class="text-center mb-8 sm:mb-12 relative">
            <img src="https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress" alt="World Class Logo" class="h-12 sm:h-16 mx-auto mb-4">
            <p id="tagline" class="text-xl text-gray-500 font-medium">þín orka, þinn árangur.</p>
            
            <!-- Language Toggle Switch -->
            <button onclick="toggleLanguage()" class="absolute top-0 right-0 sm:top-2 sm:right-2 bg-white rounded-full p-1 shadow-md border border-gray-200 focus:outline-none" aria-label="Change Language">
                <div class="relative flex w-24 h-9">
                    <!-- Slider background -->
                    <div id="lang-slider" class="absolute top-0 left-0 w-1/2 h-full bg-red-500 rounded-full shadow-sm transition-transform duration-300 ease-out"></div>
                    
                    <!-- Labels -->
                    <div id="text-is" class="relative z-10 w-1/2 flex items-center justify-center text-sm font-bold transition-colors duration-300">ÍS</div>
                    <div id="text-en" class="relative z-10 w-1/2 flex items-center justify-center text-sm font-bold transition-colors duration-300">EN</div>
                </div>
            </button>
        </header>

        <!-- Search Input & Category Filter Tabs (Sticky container) -->
        <div class="bg-white p-4 rounded-xl shadow-lg mb-8 sticky top-0 z-10">
            
            <!-- Category Filter Tabs -->
            <nav id="category-tabs" class="flex flex-wrap gap-2 sm:gap-4 justify-center font-medium">
                <!-- Buttons will be dynamically generated here -->
            </nav>
        </div>

        <!-- Category Banner Image -->
        <div id="category-banner" class="hidden mb-8">
            <!-- Image will be injected here via JavaScript -->
        </div>

        <!-- Menu Item Grid -->
        <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Menu items will be dynamically generated here -->
        </div>
        
    </div>

    <!-- Modal for Item Details -->
    <div id="item-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 hidden items-center justify-center p-4" onclick="closeModal()">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 sm:p-8 overflow-y-auto max-h-[90vh]" onclick="event.stopPropagation()">
            <!-- Modal Image -->
            <div id="modal-image-container" class="hidden mb-6 rounded-lg overflow-hidden shadow-sm">
                <img id="modal-image" class="w-full h-56 object-cover" src="" alt="Item Image">
            </div>

            <div class="flex justify-between items-start mb-4">
                <h2 id="modal-title" class="text-3xl font-bold text-gray-900"></h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="flex gap-2 mb-3">
                <p id="modal-theme" class="text-lg font-semibold px-3 py-1 inline-block rounded-full text-white"></p>
                <!-- Vegan badge for modal -->
                <p id="modal-vegan-badge" class="hidden text-lg font-semibold px-3 py-1 bg-green-500 text-white rounded-full">VEGAN</p>
            </div>
            
            <div id="modal-price-display" class="mb-4">
                <!-- Prices will be injected here -->
            </div>
            
            <h3 id="modal-desc-heading" class="text-xl font-semibold text-gray-700 mb-2">Description / Innihald</h3>
            <p id="modal-description" class="text-gray-600 mb-6 border-l-4 border-red-300 pl-3"></p>

            <div class="flex justify-between items-center mb-2">
                <h3 id="modal-macro-heading" class="text-xl font-semibold text-gray-700">Nutrition / Næringargildi</h3>
                <div id="modal-size-selector" class="flex space-x-1 font-semibold text-sm">
                    <!-- Size buttons will go here for drinks -->
                </div>
            </div>

            <div id="modal-macros" class="bg-gray-100 p-4 rounded-lg grid grid-cols-2 gap-y-2 gap-x-4">
                <!-- Macros will be injected here -->
            </div>
            <p id="modal-cal-info" class="text-sm text-gray-500 mt-2"></p>
        </div>
    </div>

    <script>
        // --- TRANSLATION DATA ---
        const IS_LANG = {
            tagline: 'þín orka, þinn árangur.',
            noItemsFound: 'Engin atriði fundust.',
            descriptionHeading: 'Lýsing / Innihald',
            nutritionHeading: 'Næringargildi',
            macroInfo: 'Næringargildi ekki tilgreind fyrir þennan rétt.',
            macroKcal: 'Kaloríur (kcal)',
            macroProtein: 'Prótein (g)',
            macroFat: 'Fita (g)',
            macroCarbs: 'Kolvetni (g)',
            macroFiber: 'Trefjar (g)',
            
            // Prices
            priceHeading: 'Verð á stærð',
            sizeSmall: 'Lítil',
            sizeMedium: 'Miðstærð',
            sizeLarge: 'Stór',
            
            // Theme Translations (Used for card badges)
            themeENERGY: 'ORKA',
            themeSTRENGTH: 'KRAFTUR',
            themeBALANCE: 'JAFNVÆGI',
            themeLIGHT: 'LÉTT',
            
            // Category Translations
            category_drykkir: 'DRYKKIR',
            category_salat: 'SALAT',
            category_grautur: 'GRAUTUR',
            category_skal: 'SKÁL',
            category_krisp: 'KRISP',
            category_kaffi: 'KAFFI',
            category_grab_go: 'GRÍPTU MEÐ',
        };
        const EN_LANG = {
            tagline: 'Your energy, your success.',
            noItemsFound: 'No items found.',
            descriptionHeading: 'Description / Ingredients',
            nutritionHeading: 'Nutrition Facts',
            macroInfo: 'Macro information not specified for this item in the menu.',
            macroKcal: 'Calories (kcal)',
            macroProtein: 'Protein (g)',
            macroFat: 'Fat (g)',
            macroCarbs: 'Carbs (g)',
            macroFiber: 'Fiber (g)',

            // Prices
            priceHeading: 'Price by Size',
            sizeSmall: 'Small',
            sizeMedium: 'Medium',
            sizeLarge: 'Large',

            // Theme Translations (Used for card badges)
            themeENERGY: 'ENERGY',
            themeSTRENGTH: 'STRENGTH',
            themeBALANCE: 'BALANCE',
            themeLIGHT: 'LIGHT',

            // Category Translations
            category_drykkir: 'DRINKS',
            category_salat: 'SALADS',
            category_grautur: 'PORRIDGE',
            category_skal: 'BOWLS',
            category_krisp: 'CRISPS',
            category_kaffi: 'COFFEE',
            category_grab_go: 'GRAB & GO',
        };

        
        // --- DRINK PRICE CONSTANTS ---

        const PRICES_THEMED_DRINKS = {
            is: { S: '1.290 kr', M: '1.490 kr', L: '1.590 kr' },
            en: { S: '1,290 ISK', M: '1,490 ISK', L: '1,590 ISK' },
        };

        const PRICES_STRENGTH_DRINKS = {
            is: { S: '1.390 kr', M: '1.590 kr', L: '1.690 kr' },
            en: { S: '1,390 ISK', M: '1,590 ISK', L: '1,690 ISK' },
        };

        // --- CATEGORY IMAGES ---
        const CATEGORY_IMAGES = {
            'DRYKKIR': 'https://images.prismic.io/worldclass/aVxY43NYClf9ozUz_menu_21920.jpg?auto=format,compress',
            'SALAT': 'https://images.prismic.io/worldclass/aVxTN3NYClf9ozUA_menu_11920.jpg',
            'GRAUTUR': 'https://images.prismic.io/worldclass/aVxTOnNYClf9ozUD_menu_41920.jpg',
            'KRISP': 'https://images.prismic.io/worldclass/aVxTOXNYClf9ozUC_menu_31920.jpg',
            'GRÍPTU MEÐ': 'https://images.prismic.io/worldclass/aVxTO3NYClf9ozUE_menu1920.jpg?auto=format,compress'
        };

        // --- THEME COLORS ---
        const THEME_COLORS = {
            'ENERGY': 'bg-orange-500',
            'STRENGTH': 'bg-red-600',
            'BALANCE': 'bg-blue-500',
            'LIGHT': 'bg-green-500',
            'VEGAN': 'bg-green-700',
            'All': 'bg-gray-800' // Default color for "All Themes" active state
        };

        // --- DRINK MACRO DATA ---
        const DRINK_MACROS = {
            // ENERGY
            Kraftur: { S: { kcal: 282.7, protein: 26.8, fat: 1.9, carbs: 36.5, fiber: 1.7 }, M: { kcal: 314, protein: 29.8, fat: 2.1, carbs: 40.5, fiber: 1.9 }, L: { kcal: 345.4, protein: 32.8, fat: 2.3, carbs: 44.6, fiber: 2.1 } },
            'Prótein ískaffi': { S: { kcal: 154.8, protein: 26.4, fat: 4.3, carbs: 1.7, fiber: 0.5 }, M: { kcal: 172, protein: 29.4, fat: 4.8, carbs: 1.9, fiber: 0.6 }, L: { kcal: 189.2, protein: 32.3, fat: 5.3, carbs: 2.1, fiber: 0.6 } },
            Snerpa: { S: { kcal: 232.2, protein: 0.7, fat: 0.5, carbs: 54.4, fiber: 4.8 }, M: { kcal: 258, protein: 0.8, fat: 0.6, carbs: 60.5, fiber: 5.3 }, L: { kcal: 283.8, protein: 0.9, fat: 0.6, carbs: 66.5, fiber: 5.8 } },
            // BALANCE
            Gleði: { S: { kcal: 227.7, protein: 24.3, fat: 1.5, carbs: 28.3, fiber: 1.8 }, M: { kcal: 253, protein: 27.0, fat: 1.7, carbs: 31.5, fiber: 2.0 }, L: { kcal: 278.3, protein: 29.7, fat: 1.8, carbs: 34.6, fiber: 2.2 } },
            Líf: { S: { kcal: 216.9, protein: 1.5, fat: 8.8, carbs: 35.8, fiber: 4.8 }, M: { kcal: 241, protein: 1.7, fat: 9.8, carbs: 39.8, fiber: 5.3 }, L: { kcal: 265.1, protein: 1.8, fat: 10.7, carbs: 43.8, fiber: 5.8 } },
            Endurnýjun: { S: { kcal: 255.6, protein: 1.2, fat: 1.4, carbs: 57.6, fiber: 5.4 }, M: { kcal: 284, protein: 1.3, fat: 1.5, carbs: 64.0, fiber: 6.0 }, L: { kcal: 312.4, protein: 1.5, fat: 1.7, carbs: 70.4, fiber: 6.6 } },
            // LIGHT
            'Græn heilsa': { S: { kcal: 180.3, protein: 12.3, fat: 1.3, carbs: 27.6, fiber: 6.4 }, M: { kcal: 200, protein: 13.7, fat: 1.5, carbs: 30.7, fiber: 7.1 }, L: { kcal: 220.7, protein: 15.0, fat: 1.6, carbs: 33.7, fiber: 7.8 } },
            Brennsla: { S: { kcal: 283.3, protein: 23.3, fat: 1.7, carbs: 43.7, fiber: 6.3 }, M: { kcal: 300, protein: 25.9, fat: 1.9, carbs: 48.6, fiber: 7.0 }, L: { kcal: 347, protein: 28.5, fat: 2.1, carbs: 53.5, fiber: 7.7 } },
            Upphitun: { S: { kcal: 177.3, protein: 11.0, fat: 2.3, carbs: 30.5, fiber: 2.7 }, M: { kcal: 197, protein: 12.2, fat: 2.5, carbs: 33.9, fiber: 3.0 }, L: { kcal: 216.7, protein: 13.4, fat: 2.8, carbs: 37.3, fiber: 3.3 } },
            // STRENGTH
            Massi: { S: { kcal: 636.3, protein: 39.4, fat: 31.3, carbs: 61.4, fiber: 12.5 }, M: { kcal: 707, protein: 43.8, fat: 34.8, carbs: 68.2, fiber: 13.9 }, L: { kcal: 777.7, protein: 48.2, fat: 38.3, carbs: 75.0, fiber: 15.3 } },
            Orka: { S: { kcal: 833.4, protein: 44.0, fat: 38.3, carbs: 86.1, fiber: 15.8 }, M: { kcal: 926, protein: 48.9, fat: 42.5, carbs: 95.7, fiber: 17.5 }, L: { kcal: 1018.6, protein: 53.8, fat: 46.8, carbs: 105.3, fiber: 19.3 } },
            Berjabomba: { S: { kcal: 778.5, protein: 24.4, fat: 67.7, carbs: 21.8, fiber: 4.8 }, M: { kcal: 865, protein: 27.5, fat: 75.2, carbs: 24.2, fiber: 5.3 }, L: { kcal: 951, protein: 29.8, fat: 82.7, carbs: 26.6, fiber: 5.8 } }
        };

        const initialMenuData = [
            // --- DRYKKIR (Drinks) ---
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'ENERGY', nameIs: 'Kraftur', nameEn: 'Power', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Vanillu skyr, banani, jarðarber, prótein', descriptionEn: 'Vanilla Skyr, banana, strawberries, protein powder', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'ENERGY', nameIs: 'Prótein ískaffi', nameEn: 'Protein Iced Coffee', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Tvöfaldur espresso, möndlumjólk, ólífuolía, prótein', descriptionEn: 'Double espresso, almond milk, olive oil, protein powder', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'ENERGY', nameIs: 'Snerpa', nameEn: 'Vigor', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Jarðarber, banani, epli, Peach Mango Tango Amino Energy', descriptionEn: 'Strawberries, banana, apple, Peach Mango Tango Amino Energy', macros: {}, isVegan: true },
            
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'BALANCE', nameIs: 'Gleði', nameEn: 'Joy', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Sítróna, engifer, jarðarber, epli, jarðarberjaprótein', descriptionEn: 'Lemon, ginger, strawberries, apple, strawberry protein powder', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'BALANCE', nameIs: 'Líf', nameEn: 'Life', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Avókadó, epli, ananas, engifer', descriptionEn: 'Avocado, apple, pineapple, ginger', macros: {}, isVegan: true },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'BALANCE', nameIs: 'Endurnýjun', nameEn: 'Renewal', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Rauðrófusafi, avókadó, sellerí, jarðarber, epli, sítróna', descriptionEn: 'Beetroot juice, avocado, celery, strawberries, apple, lemon', macros: {}, isVegan: true },

            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'LIGHT', nameIs: 'Græn heilsa', nameEn: 'Green Health', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Spínat, mangó, epli, sellerí, engifer, collagen prótein', descriptionEn: 'Spinach, mango, apple, celery, ginger, collagen protein', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'LIGHT', nameIs: 'Brennsla', nameEn: 'Metabolism', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Epli, mangó, bláber, engifer, prótein', descriptionEn: 'Apple, mango, blueberries, ginger, protein powder', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'LIGHT', nameIs: 'Upphitun', nameEn: 'Warm-up', prices: PRICES_THEMED_DRINKS, descriptionIs: 'Vanillu skyr, jarðarber, mangó, ananas', descriptionEn: 'Vanilla Skyr, strawberries, mango, pineapple', macros: {} },

            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'STRENGTH', nameIs: 'Massi', nameEn: 'Bulk', prices: PRICES_STRENGTH_DRINKS, descriptionIs: 'Jarðarber, döðlur, banani, hnetusmjör, kakóduft, möndlu-mjólk, Cookies & Cream prótein', descriptionEn: 'Strawberries, dates, banana, peanut butter, cocoa powder, almond milk, Cookies & Cream protein', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'STRENGTH', nameIs: 'Orka', nameEn: 'Energy', prices: PRICES_STRENGTH_DRINKS, descriptionIs: 'Banani, haframjöl, haframjólk, möndlusmjör, Whey prótein', descriptionEn: 'Banana, oatmeal, oat milk, almond butter, Whey protein', macros: {} },
            { categoryIs: 'DRYKKIR', categoryEn: 'DRINKS', theme: 'STRENGTH', nameIs: 'Berjabomba', nameEn: 'Berry Bomb', prices: PRICES_STRENGTH_DRINKS, descriptionIs: 'Hindber, bláber, ólífuolía, kókosmjólk, prótein', descriptionEn: 'Raspberries, blueberries, olive oil, coconut milk, protein powder', macros: {} },

            // --- SALAT (Salads) ---
            { 
                categoryIs: 'SALAT', 
                categoryEn: 'SALADS', 
                theme: 'ENERGY', 
                nameIs: 'Energy salat', 
                nameEn: 'Energy Salad', 
                priceIs: '2.190 kr', 
                priceEn: '2,190 ISK', 
                descriptionIs: 'Pestó pasta, tómatar, spínat, döðlur, kasjúhnetur, fetaostur', 
                descriptionEn: 'Pesto pasta, tomatoes, spinach, dates, cashews, feta cheese', 
                macros: { kcal: 991, protein: '32.2 g', fat: '49.4 g', carbs: '102 g', fiber: '17 g' },
            },
            { 
                categoryIs: 'SALAT', 
                categoryEn: 'SALADS', 
                theme: 'STRENGTH', 
                nameIs: 'Strength salat', 
                nameEn: 'Strength Salad', 
                priceIs: '2.190 kr', 
                priceEn: '2,190 ISK', 
                descriptionIs: 'Pasta, salat, kjúklingur, vínber, döðlur, parmesan ostur, cesar dressing', 
                descriptionEn: 'Pasta, lettuce, chicken, grapes, dates, Parmesan cheese, Caesar dressing', 
                macros: { kcal: 869, protein: '66.4 g', fat: '32.4 g', carbs: '86.2 g', fiber: '12 g' },
            },
            { 
                categoryIs: 'SALAT', 
                categoryEn: 'SALADS', 
                theme: 'BALANCE', 
                nameIs: 'Balance salat', 
                nameEn: 'Balance Salad', 
                priceIs: '2.190 kr', 
                priceEn: '2,190 ISK', 
                descriptionIs: 'Salat, grænmetisbuff, avocado, rauðlaukur, gúrka, tómatar, vinegar dressing', 
                descriptionEn: 'Lettuce, veggie patty, avocado, red onion, cucumber, tomatoes, vinegar dressing', 
                macros: { kcal: 539, protein: '11.4 g', fat: '37.6 g', carbs: '42.2 g', fiber: '9.5 g' },
                isVegan: true,
            },
            { 
                categoryIs: 'SALAT', 
                categoryEn: 'SALADS', 
                theme: 'LIGHT', 
                nameIs: 'Light salat', 
                nameEn: 'Light Salad', 
                priceIs: '1.890 kr', 
                priceEn: '1,890 ISK', 
                descriptionIs: 'Salat, túnfiskur, egg, rauðlaukur, gúrka, kotasæludressing', 
                descriptionEn: 'Lettuce, tuna, egg, red onion, cucumber, cottage cheese dressing', 
                macros: { kcal: 452, protein: '48.5 g', fat: '16.5 g', carbs: '14.7 g', fiber: '3.5 g' },
            },

            // --- GRAUTUR (Porridge) ---
            { categoryIs: 'GRAUTUR', categoryEn: 'PORRIDGE', theme: 'ENERGY', nameIs: 'Energy Grautur', nameEn: 'Energy Porridge', priceIs: '990 kr', priceEn: '990 ISK', descriptionIs: 'Möndlumjólk, hafrar, hunang, cookies and cream prótein. Toppings: möndlusmjör, bláber, jarðarber', descriptionEn: 'Almond milk, oats, honey, cookies and cream protein. Toppings: almond butter, blueberries, strawberries', macros: { kcal: 641.6, protein: '37.23 g', fat: '16 g', carbs: '82.4 g', fiber: '11.4 g' } },
            { categoryIs: 'GRAUTUR', categoryEn: 'PORRIDGE', theme: 'STRENGTH', nameIs: 'Strength Grautur', nameEn: 'Strength Porridge', priceIs: '990 kr', priceEn: '990 ISK', descriptionIs: 'Möndlumjólk, hafrar, hunang, vanillu prótein. Toppings: hnetusmjör, banani, döðlur', descriptionEn: 'Almond milk, oats, honey, vanilla protein. Toppings: peanut butter, banana, dates', macros: { kcal: 658, protein: '38.13 g', fat: '16.02 g', carbs: '97.2 g', fiber: '12.44 g' } },
            { categoryIs: 'GRAUTUR', categoryEn: 'PORRIDGE', theme: 'BALANCE', nameIs: 'Balance Grautur', nameEn: 'Balance Porridge', priceIs: '990 kr', priceEn: '990 ISK', descriptionIs: 'Möndlumjólk, hafrar, hunang, collagen. Toppings: hampfræ, bláber, döðlur', descriptionEn: 'Almond milk, oats, honey, collagen. Toppings: hemp seeds, blueberries, dates', macros: { kcal: 533.6, protein: '49 g', fat: '9.72 g', carbs: '96.8 g', fiber: '11.54 g' } },
            { categoryIs: 'GRAUTUR', categoryEn: 'PORRIDGE', theme: 'LIGHT', nameIs: 'Light Grautur', nameEn: 'Light Porridge', priceIs: '890 kr', priceEn: '890 ISK', descriptionIs: 'Möndlumjólk, hafrar, hunang. Toppings: hampfræ, Jarðarber, kókosflögu', descriptionEn: 'Almond milk, oats, honey. Toppings: hemp seeds, strawberries, coconut flakes', macros: { kcal: 442.6, protein: '12.73 g', fat: '16.22 g', carbs: '66.4 g', fiber: '10.64 g' } },

            // --- KRISP (Crisps) ---
            { 
                categoryIs: 'KRISP', 
                categoryEn: 'CRISPS', 
                theme: 'ENERGY', 
                nameIs: 'Kjúklinga & avacado krisp', 
                nameEn: 'Chicken & Avocado Crisp', 
                priceIs: '1.290 kr', 
                priceEn: '1,290 ISK', 
                descriptionIs: 'Fin crisp, kjúklingur, avocado, sesamfræ', 
                descriptionEn: 'Thin crisp, chicken, avocado, sesame seeds', 
                macros: { kcal: 290, protein: '22.8 g', fat: '14.5 g', carbs: '21.9 g', fiber: '6.6 g' } 
            },
            { 
                categoryIs: 'KRISP', 
                categoryEn: 'CRISPS', 
                theme: 'STRENGTH', 
                nameIs: 'Túnfisk & egg krisp', 
                nameEn: 'Tuna & Egg Crisp', 
                priceIs: '1.290 kr', 
                priceEn: '1,290 ISK', 
                descriptionIs: 'Fin crisp, túnfisksalat', 
                descriptionEn: 'Thin crisp, tuna salad', 
                macros: { kcal: 313, protein: '31.8 g', fat: '15.5 g', carbs: '16.9 g', fiber: '4.6 g' } 
            },
            { categoryIs: 'KRISP', categoryEn: 'CRISPS', theme: 'BALANCE', nameIs: 'Hummus krisp', nameEn: 'Hummus Crisp', priceIs: '1.190 kr', priceEn: '1,190 ISK', descriptionIs: 'Fin crisp, hummus, tómatar', descriptionEn: 'Thin crisp, hummus, tomatoes', macros: { kcal: 263, protein: '10.8 g', fat: '7.5 g', carbs: '49.9 g', fiber: '18.6 g' }, isVegan: true },
            { categoryIs: 'KRISP', categoryEn: 'CRISPS', theme: 'LIGHT', nameIs: 'Kjúklinga krisp', nameEn: 'Chicken Crisp', priceIs: '1.190 kr', priceEn: '1,190 ISK', descriptionIs: 'Fin crisp, kjúklingasalat', descriptionEn: 'Thin crisp, chicken salad', macros: { kcal: 288, protein: '28.8 g', fat: '12.5 g', carbs: '14.9 g', fiber: '4.1 g' } },

            // --- KAFFI (Coffee) --- 
            { categoryIs: 'KAFFI', categoryEn: 'COFFEE', theme: 'All', nameIs: 'Americano', nameEn: 'Americano', priceIs: '500 kr', priceEn: '500 ISK', descriptionIs: 'Standard kaffi, svart.', descriptionEn: 'Standard coffee, black.', macros: {}, isVegan: true },
            { categoryIs: 'KAFFI', categoryEn: 'COFFEE', theme: 'All', nameIs: 'Espresso', nameEn: 'Espresso', priceIs: '500 kr', priceEn: '500 ISK', descriptionIs: 'Stakur skammtur af espresso.', descriptionEn: 'Single shot of espresso.', macros: {}, isVegan: true },
            { categoryIs: 'KAFFI', categoryEn: 'COFFEE', theme: 'All', nameIs: 'Tvöfaldur Espresso', nameEn: 'Double Espresso', priceIs: '500 kr', priceEn: '500 ISK', descriptionIs: 'Tvöfaldur skammtur af espresso.', descriptionEn: 'Double shot of espresso.', macros: {}, isVegan: true },
            { categoryIs: 'KAFFI', categoryEn: 'COFFEE', theme: 'All', nameIs: 'Cappucino', nameEn: 'Cappuccino', priceIs: '500 kr', priceEn: '500 ISK', descriptionIs: 'Espresso með mjólk og freyði.', descriptionEn: 'Espresso with steamed milk and foam.', macros: {} },
            { categoryIs: 'KAFFI', categoryEn: 'COFFEE', theme: 'All', nameIs: 'Latte', nameEn: 'Latte', priceIs: '500 kr', priceEn: '500 ISK', descriptionIs: 'Espresso með heitri mjólk.', descriptionEn: 'Espresso with hot milk.', macros: {} },

             // --- GRÍPTU MEÐ (Grab & Go) ---
            { categoryIs: 'GRÍPTU MEÐ', categoryEn: 'GRAB & GO', theme: 'All', nameIs: 'Prótein muffins', nameEn: 'Protein Muffin', priceIs: '590 kr', priceEn: '590 ISK', descriptionIs: 'High protein muffin for a quick snack.', descriptionEn: 'High protein muffin for a quick snack.', macros: {} },
            { categoryIs: 'GRÍPTU MEÐ', categoryEn: 'GRAB & GO', theme: 'All', nameIs: 'Egg', nameEn: 'Egg', priceIs: '250 kr', priceEn: '250 ISK', descriptionIs: 'Hard-boiled egg.', descriptionEn: 'Hard-boiled egg.', macros: {} },
            { categoryIs: 'GRÍPTU MEÐ', categoryEn: 'GRAB & GO', theme: 'All', nameIs: 'Epli', nameEn: 'Apple', priceIs: '150 kr', priceEn: '150 ISK', descriptionIs: 'Epli.', descriptionEn: 'Apple.', macros: {}, isVegan: true },
            { categoryIs: 'GRÍPTU MEÐ', categoryEn: 'GRAB & GO', theme: 'All', nameIs: 'Banani', nameEn: 'Banana', priceIs: '170 kr', priceEn: '170 ISK', descriptionIs: 'Banani.', descriptionEn: 'Banana.', macros: {}, isVegan: true },
            { categoryIs: 'GRÍPTU MEÐ', categoryEn: 'GRAB & GO', theme: 'All', nameIs: 'Harðfiskur', nameEn: 'Dried Fish', priceIs: '990 kr', priceEn: '990 ISK', descriptionIs: 'Íslenskur harðfiskur.', descriptionEn: 'Icelandic dried fish.', macros: {} },
            { categoryIs: 'GRÍPTU MEÐ', categoryEn: 'GRAB & GO', theme: 'All', nameIs: 'Hnetumix', nameEn: 'Nut Mix', priceIs: '390 kr', priceEn: '390 ISK', descriptionIs: 'Blandaðar hnetur.', descriptionEn: 'Mixed nuts.', macros: {}, isVegan: true },
        ];
        
        // --- PROCESS MENU DATA (Add size-based macros to drinks) ---
        const menuData = initialMenuData.map(item => {
            if (item.categoryIs === 'DRYKKIR') {
                const macros = DRINK_MACROS[item.nameIs] || {};
                return { ...item, macros: macros, isSizeBased: true };
            }
            // Add a flag for non-drink items
            return { ...item, isSizeBased: false };
        });

        // --- STATE VARIABLES ---
        let isIcelandic = false; // Tracks the current language (false = English, true = Icelandic)
        let activeCategory = 'DRYKKIR'; 
        let modalActiveSize = 'M'; // Default size for macro display for drinks

        const menuGrid = document.getElementById('menu-grid');
        const categoryTabs = document.getElementById('category-tabs');
        // const translateButton = document.getElementById('translate-button'); // Removed old button ref
        const langSlider = document.getElementById('lang-slider'); // New refs
        const textIs = document.getElementById('text-is');
        const textEn = document.getElementById('text-en');
        
        const categoryBanner = document.getElementById('category-banner'); 
        const modal = document.getElementById('item-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalTheme = document.getElementById('modal-theme');
        const modalPriceDisplay = document.getElementById('modal-price-display');
        const modalDescription = document.getElementById('modal-description');
        const modalMacros = document.getElementById('modal-macros');
        const modalCalInfo = document.getElementById('modal-cal-info');
        const modalDescHeading = document.getElementById('modal-desc-heading');
        const modalMacroHeading = document.getElementById('modal-macro-heading');
        const modalSizeSelector = document.getElementById('modal-size-selector');
        const modalVeganBadge = document.getElementById('modal-vegan-badge');
        const modalImageContainer = document.getElementById('modal-image-container');
        const modalImage = document.getElementById('modal-image');


        // --- TRANSLATION FUNCTIONALITY ---

        const getLang = () => isIcelandic ? IS_LANG : EN_LANG;
        
        // Helper to get translated theme name
        const getTranslatedThemeName = (themeKey) => {
            const lang = getLang();
            return lang[`theme${themeKey}`] || themeKey;
        };

        // Always return Icelandic name with English translation appended if available
        const getDisplayName = (item) => {
            // EXCEPTION: User requested single names for SALAT and GRAUTUR
            // If category is Salad or Porridge, always toggle strictly between languages
            if (item.categoryIs === 'SALAT' || item.categoryIs === 'GRAUTUR') {
                 return isIcelandic ? item.nameIs : item.nameEn;
            }

            // Check if the name contains specific keywords to keep dual display
            // Keywords are essentially the theme names often found in item names
            const keywords = ['energy', 'strength', 'balance', 'light'];
            
            // Check if the English name contains any of these keywords
            const nameLower = item.nameEn.toLowerCase();
            const isThemedItem = keywords.some(keyword => nameLower.includes(keyword));

            if (isThemedItem) {
                // If names are identical, just return one
                if (item.nameIs === item.nameEn) {
                    return item.nameIs;
                }
                // Always show both for these specific items (mostly Drinks)
                return `${item.nameIs} (${item.nameEn})`;
            }

            // Default: Show only the active language name
            return isIcelandic ? item.nameIs : item.nameEn;
        };
        
        // Helper to get translated category name
        const getCategoryDisplayName = (categoryKey) => {
            const lang = getLang();
            let lookupKey;

            // FIX: Map the problematic Icelandic string directly to the intended English key
            if (categoryKey === 'GRÍPTU MEÐ') {
                lookupKey = 'category_grab_go'; 
            } else {
                // Category keys are simplified in the Lang objects (e.g., 'DRYKKIR' -> 'category_drykkir')
                lookupKey = 'category_' + categoryKey.toLowerCase().replace(/[^a-z]/g, '');
            }
            
            return lang[lookupKey] || categoryKey;
        }

        const updateStaticText = () => {
            const lang = getLang();
            
            // 1. Update Header Tagline
            document.getElementById('tagline').textContent = lang.tagline;

            // 2. Update Language Toggle Visuals
            if (isIcelandic) {
                // Slide to Left (IS)
                langSlider.classList.remove('translate-x-full');
                langSlider.classList.add('translate-x-0');
                
                // Colors
                textIs.classList.remove('text-gray-500');
                textIs.classList.add('text-white');
                textEn.classList.remove('text-white');
                textEn.classList.add('text-gray-500');
            } else {
                // Slide to Right (EN)
                langSlider.classList.remove('translate-x-0');
                langSlider.classList.add('translate-x-full');
                
                // Colors
                textIs.classList.remove('text-white');
                textIs.classList.add('text-gray-500');
                textEn.classList.remove('text-gray-500');
                textEn.classList.add('text-white');
            }
            
            // 3. Update Modal Headings
            modalDescHeading.textContent = lang.descriptionHeading;
            modalMacroHeading.textContent = lang.nutritionHeading;
            
            // 4. Re-render everything to update category labels, item descriptions, and macro data
            renderCategoryTabs();
            renderMenu();
        };

        window.toggleLanguage = () => {
            isIcelandic = !isIcelandic;
            updateStaticText();
        };

        // --- FILTERING AND RENDERING ---

        const filterItems = () => {
            return menuData.filter(item => {
                const categoryMatch = item.categoryIs === activeCategory;
                // Removed theme filtering logic as the selector is gone
                const categoryIsRemoved = item.categoryIs === 'SKÁL'; 
                return categoryMatch && !categoryIsRemoved;
            });
        };

        const getThemeColor = (theme) => {
            // Use the shared THEME_COLORS object, fallback to gray if undefined
            return THEME_COLORS[theme] || 'bg-gray-500';
        };

        const renderMenu = () => {
            const filteredItems = filterItems();
            const lang = getLang();
            menuGrid.innerHTML = ''; 

            // Handle Category Banner
            const categoryImage = CATEGORY_IMAGES[activeCategory];
            if (categoryImage) {
                categoryBanner.innerHTML = `<img src="${categoryImage}" class="w-full h-48 sm:h-64 object-cover rounded-xl shadow-md" alt="${getCategoryDisplayName(activeCategory)}">`;
                categoryBanner.classList.remove('hidden');
            } else {
                categoryBanner.innerHTML = '';
                categoryBanner.classList.add('hidden');
            }

            if (filteredItems.length === 0) {
                menuGrid.innerHTML = `<div class="md:col-span-2 text-center py-12 text-gray-500 text-xl">
                    ${lang.noItemsFound}
                </div>`;
                return;
            }

            filteredItems.forEach(item => {
                const isDescription = isIcelandic ? item.descriptionIs : item.descriptionEn;
                const displayName = getDisplayName(item);
                const themeColor = getThemeColor(item.theme);
                const themeName = getTranslatedThemeName(item.theme);
                
                // Generate Vegan icon HTML if applicable
                const veganIconHtml = item.isVegan ? `<span class="ml-2 text-xs font-bold bg-green-100 text-green-700 border border-green-200 px-2 py-0.5 rounded-full">VEGAN</span>` : '';

                let cardPriceHtml = ''; 
                
                if (item.prices) {
                    const priceString = isIcelandic ? item.prices.is.M : item.prices.en.M;
                    const sizeLabel = lang.sizeMedium;
                    
                    cardPriceHtml = `
                        <span class="text-xs text-gray-500 font-normal mr-1">${sizeLabel}:</span>
                        <span class="text-xl font-bold text-red-500">${priceString}</span>
                    `;
                } else {
                    const flatPrice = isIcelandic ? item.priceIs : item.priceEn;
                    cardPriceHtml = `<span class="text-xl font-bold text-red-500">${flatPrice}</span>`;
                }

                // Changed structure: No longer rendering item image in card
                const itemHtml = `
                    <div class="item-card bg-white rounded-xl shadow-md flex flex-col cursor-pointer overflow-hidden" onclick="openModal(${menuData.indexOf(item)})">
                        <div class="p-6 flex flex-col flex-grow">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center">
                                    <span class="text-sm font-semibold px-3 py-1 ${themeColor} rounded-full text-white">${themeName}</span>
                                    ${veganIconHtml}
                                </div>
                                <div class="flex items-baseline">
                                    ${cardPriceHtml}
                                </div>
                            </div>
                            <h3 class="text-2xl font-extrabold text-gray-900 mb-2">${displayName}</h3>
                            <p class="text-gray-500 text-sm mt-auto">${isDescription}</p>
                        </div>
                    </div>
                `;
                menuGrid.innerHTML += itemHtml;
            });
        };

        const renderCategoryTabs = () => {
            const categories = [...new Set(menuData.map(item => item.categoryIs))].filter(c => c !== 'SKÁL');
            categoryTabs.innerHTML = '';
            
            categories.forEach(categoryKey => {
                const isActive = categoryKey === activeCategory;
                const categoryDisplayName = getCategoryDisplayName(categoryKey);

                const button = document.createElement('button');
                button.textContent = categoryDisplayName;
                // Reverted to standard Red/Gray styling for Category Tabs
                button.className = `px-4 py-2 rounded-lg font-semibold transition-colors ${
                    isActive 
                        ? 'bg-red-500 text-white shadow-lg' 
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`;
                button.onclick = () => {
                    activeCategory = categoryKey;
                    renderCategoryTabs();
                    renderMenu();
                };
                categoryTabs.appendChild(button);
            });
        };

        
        // --- MODAL FUNCTIONALITY ---

        const renderSizeSelector = (itemIndex) => {
            const item = menuData[itemIndex];
            if (!item.isSizeBased) {
                modalSizeSelector.innerHTML = '';
                return;
            }

            modalActiveSize = modalActiveSize || 'M'; // Ensure a size is selected if it was cleared

            modalSizeSelector.innerHTML = `
                <button class="size-button ${modalActiveSize === 'S' ? 'active' : 'bg-gray-200'}" onclick="setModalSize(${itemIndex}, 'S')">S</button>
                <button class="size-button ${modalActiveSize === 'M' ? 'active' : 'bg-gray-200'}" onclick="setModalSize(${itemIndex}, 'M')">M</button>
                <button class="size-button ${modalActiveSize === 'L' ? 'active' : 'bg-gray-200'}" onclick="setModalSize(${itemIndex}, 'L')">L</button>
            `;
        };
        
        window.setModalSize = (itemIndex, size) => {
            modalActiveSize = size;
            const item = menuData[itemIndex];
            
            // Re-render size selector to update active state
            renderSizeSelector(itemIndex);
            
            // Re-render macros
            renderModalMacros(item);

            // Re-render price display (as prices are also size-dependent)
            renderModalPriceDisplay(item);
        };

        const renderModalMacros = (item) => {
            const lang = getLang();
            modalMacros.innerHTML = '';

            // Determine which set of macros to display
            let macrosToDisplay = {};
            
            if (item.isSizeBased) {
                // For drinks, use the current active size
                macrosToDisplay = item.macros[modalActiveSize] || {};
            } else {
                // For other items, use the single macro object
                macrosToDisplay = item.macros;
            }

            if (Object.keys(macrosToDisplay).length === 0) {
                modalCalInfo.textContent = lang.macroInfo;
                modalMacros.innerHTML = '';
            } else {
                modalCalInfo.textContent = ''; // Clear the warning if macros exist

                const macroMap = {
                    kcal: lang.macroKcal,
                    protein: lang.macroProtein,
                    fat: lang.macroFat,
                    carbs: lang.macroCarbs,
                    fiber: lang.macroFiber,
                };

                // Filter out undefined/null macros and generate HTML
                Object.entries(macrosToDisplay).forEach(([key, value]) => {
                    if (value !== undefined && value !== null && macroMap[key]) {
                        // Format value: ensure number formatting for decimal places
                        let displayValue = typeof value === 'number' 
                            ? value.toFixed(1).replace(/\.0+$/, '') 
                            : value;
                            
                        // Append unit only to P, F, C, Fiber
                        if (key !== 'kcal') {
                            displayValue += ' g';
                        }

                        const macroHtml = `
                            <div class="flex justify-between border-b border-gray-200 last:border-b-0 py-1">
                                <span class="font-medium text-gray-600">${macroMap[key]}</span>
                                <span class="font-bold text-gray-800">${displayValue}</span>
                            </div>
                        `;
                        modalMacros.innerHTML += macroHtml;
                    }
                });
            }
        }
        
        const renderModalPriceDisplay = (item) => {
            const lang = getLang();
            const itemIndex = menuData.indexOf(item); // Get index for onclick handler
            modalPriceDisplay.innerHTML = '';

            if (item.prices) {
                // Item is a drink with multiple prices
                const currentPrices = isIcelandic ? item.prices.is : item.prices.en;

                const priceHtml = `
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">${lang.priceHeading}</h3>
                    <div class="grid grid-cols-3 gap-3 font-bold text-lg text-center">
                        <div onclick="setModalSize(${itemIndex}, 'S')" class="cursor-pointer transition-all p-2 rounded-lg ${modalActiveSize === 'S' ? 'bg-red-200 ring-2 ring-red-500' : 'bg-red-100 hover:bg-red-200'}">
                            <span class="text-sm block text-gray-600">${lang.sizeSmall}</span>
                            <span class="text-red-600">${currentPrices.S}</span>
                        </div>
                        <div onclick="setModalSize(${itemIndex}, 'M')" class="cursor-pointer transition-all p-2 rounded-lg ${modalActiveSize === 'M' ? 'bg-red-200 ring-2 ring-red-500' : 'bg-red-100 hover:bg-red-200'}">
                            <span class="text-sm block text-gray-700">${lang.sizeMedium}</span>
                            <span class="text-red-700">${currentPrices.M}</span>
                        </div>
                        <div onclick="setModalSize(${itemIndex}, 'L')" class="cursor-pointer transition-all p-2 rounded-lg ${modalActiveSize === 'L' ? 'bg-red-200 ring-2 ring-red-500' : 'bg-red-100 hover:bg-red-200'}">
                            <span class="text-sm block text-gray-600">${lang.sizeLarge}</span>
                            <span class="text-red-600">${currentPrices.L}</span>
                        </div>
                    </div>
                `;
                modalPriceDisplay.innerHTML = priceHtml;

            } else {
                // Item has a flat price
                const flatPrice = isIcelandic ? item.priceIs : item.priceEn;
                 const priceHtml = `
                    <h3 class="text-2xl font-extrabold text-red-500 mb-2">${flatPrice}</h3>
                `;
                modalPriceDisplay.innerHTML = priceHtml;
            }
        }


        window.openModal = (index) => {
            const item = menuData[index];
            const themeColor = getThemeColor(item.theme);
            const themeName = getTranslatedThemeName(item.theme);
            const displayName = getDisplayName(item); 
            const isDescription = isIcelandic ? item.descriptionIs : item.descriptionEn;

            // 1. Set default size state for drinks (always start at Medium)
            if (item.isSizeBased) {
                modalActiveSize = 'M'; 
            } else {
                modalActiveSize = null;
            }

            modalTitle.textContent = displayName;
            modalDescription.textContent = isDescription;
            
            modalTheme.textContent = themeName;
            modalTheme.className = `text-lg font-semibold px-3 py-1 inline-block rounded-full text-white ${themeColor}`;

            // Show/Hide Vegan Badge in Modal
            if (item.isVegan) {
                modalVeganBadge.classList.remove('hidden');
                modalVeganBadge.classList.add('inline-block');
            } else {
                modalVeganBadge.classList.add('hidden');
                modalVeganBadge.classList.remove('inline-block');
            }
            
            // Show/Hide Image in Modal - NOTE: We removed item.image earlier for cards, 
            // but if we want images in modals we might need to put them back in data.
            // For now, based on instructions, we rely on category banners.
            // But let's keep the logic clean just in case.
            if (item.image) {
                modalImageContainer.classList.remove('hidden');
                modalImage.src = item.image;
            } else {
                modalImageContainer.classList.add('hidden');
                modalImage.src = '';
            }

            // 2. Render Price Display (with size selection rings if applicable)
            renderModalPriceDisplay(item);

            // 3. Render Size Selector for Macros (only for drinks)
            renderSizeSelector(index);

            // 4. Render Macros
            renderModalMacros(item);

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        window.closeModal = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };

        // --- INITIALIZATION ---
        const init = () => {
            // Check URL parameters for language preference
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('lang') === 'is') {
                isIcelandic = true;
            }

            updateStaticText(); 
            // Ensure category starts at a valid non-removed category
            if (activeCategory === 'SKÁL') {
                 activeCategory = 'DRYKKIR';
            }
            renderCategoryTabs();
            renderMenu();
        };

        init();
    </script>
</body>
</html>
