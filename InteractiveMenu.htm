<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Class+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f87171;
            --secondary: #111827;
            --background: #fafafa;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--secondary);
            -webkit-tap-highlight-color: transparent;
            scroll-behavior: smooth;
        }
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .scroll-mask-container {
            position: relative;
            mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
        }

        .item-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.05);
        }
        .category-tab {
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }

        .toggle-dot {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .category-scroll-indicator {
            height: 2px;
            background-color: #e5e7eb;
            position: relative;
            margin: 0 2rem;
            border-radius: 2px;
            overflow: hidden;
        }

        .category-scroll-thumb {
            height: 100%;
            width: 30%;
            background-color: var(--primary);
            position: absolute;
            left: 0;
            transition: transform 0.1s linear;
        }

        .sort-btn {
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .sort-btn.active {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .logo-animated {
            width: 280px;
            height: 60px;
            background: linear-gradient(
                45deg, 
                #34d399, 
                #38bdf8, 
                #fb923c, 
                #ef4444, 
                #34d399  
            );
            background-size: 300% 300%;
            -webkit-mask: url("https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress") no-repeat center;
            mask: url("https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            animation: logoGradientFlow 8s ease infinite;
        }

        @keyframes logoGradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #category-hero {
            background-color: #1a1a1a;
            isolation: isolate;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            overflow: hidden;
        }

        .macro-circle {
            transform-origin: center;
            transition: stroke-dashoffset 0.8s ease-in-out; 
        }

        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 12px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: 600;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }

        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }
    </style>
</head>
<body class="antialiased selection:bg-red-100 selection:text-red-600">

    <div class="max-w-4xl mx-auto px-4 pt-4 pb-8 sm:pt-8 sm:pb-12">
        
        <!-- Haus -->
        <header class="flex flex-col items-center mb-10">
            <div class="w-full flex justify-end items-center mb-4 sm:mb-8">
                <div class="flex items-center gap-3 bg-white p-1.5 rounded-full shadow-sm border border-gray-100">
                    <span id="lang-label-is-plain" class="text-[10px] font-bold text-red-500 transition-colors tracking-widest px-1">ÍS</span>
                    <button onclick="toggleLanguage()" class="relative w-10 h-5 bg-gray-100 rounded-full p-0.5 transition-colors hover:bg-gray-200 focus:outline-none">
                        <div id="toggle-dot" class="toggle-dot w-4 h-4 bg-white rounded-full shadow-sm transform border border-gray-100"></div>
                    </button>
                    <span id="lang-label-en" class="text-[10px] font-bold text-gray-400 transition-colors tracking-widest px-1">EN</span>
                </div>
            </div>
            
            <div class="logo-animated mb-4"></div>
            <p id="tagline" class="text-gray-400 font-semibold text-[10px] sm:text-xs text-center tracking-[0.2em] uppercase"></p>
        </header>

        <!-- Flokkar -->
        <div class="sticky top-4 z-40 mb-6 space-y-3">
            <div class="glass rounded-2xl shadow-sm border border-gray-100/50">
                <div class="scroll-mask-container">
                    <nav id="category-tabs" class="flex overflow-x-auto no-scrollbar gap-2 w-full py-4 px-8" onscroll="updateCategoryScroll()">
                    </nav>
                </div>
                <div class="category-scroll-indicator">
                    <div id="category-scroll-thumb" class="category-scroll-thumb"></div>
                </div>
            </div>
        </div>

        <!-- Þemasíur -->
        <div id="theme-filters" class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-10">
        </div>

        <!-- Hero -->
        <div class="mb-6">
            <div id="category-hero" class="rounded-2xl overflow-hidden shadow-xl relative h-36 sm:h-64 hidden animate-slide-up">
                <img id="hero-img" src="" class="w-full h-full object-cover" alt="Borðamynd">
                <div id="hero-color-overlay" class="absolute inset-0 transition-all duration-300 pointer-events-none mix-blend-multiply opacity-0 z-10"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent flex items-end p-6 z-20">
                    <h2 id="hero-title" class="text-white text-2xl sm:text-4xl font-black uppercase tracking-tight"></h2>
                </div>
            </div>
        </div>

        <!-- Röðun -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-3 mb-8 px-1">
            <span id="sort-label" class="text-[9px] font-black uppercase tracking-widest text-gray-400 whitespace-nowrap">Raða eftir:</span>
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1 sm:pb-0">
                <button onclick="setSort('kcal')" id="sort-kcal" class="sort-btn px-4 py-1.5 rounded-full text-[9px] font-bold border border-gray-200 bg-white text-gray-500 hover:border-gray-300 uppercase tracking-widest">Kcal</button>
                <button onclick="setSort('protein')" id="sort-protein" class="sort-btn px-4 py-1.5 rounded-full text-[9px] font-bold border border-gray-200 bg-white text-gray-500 hover:border-gray-300 uppercase tracking-widest">Prótein</button>
                <button onclick="setSort('carbs')" id="sort-carbs" class="sort-btn px-4 py-1.5 rounded-full text-[9px] font-bold border border-gray-200 bg-white text-gray-500 hover:border-gray-300 uppercase tracking-widest">Kolvetni</button>
                <button onclick="setSort('fat')" id="sort-fat" class="sort-btn px-4 py-1.5 rounded-full text-[9px] font-bold border border-gray-200 bg-white text-gray-500 hover:border-gray-300 uppercase tracking-widest">Fita</button>
                <button onclick="setSort('category')" id="sort-category" class="sort-btn px-4 py-1.5 rounded-full text-[9px] font-bold border border-gray-200 bg-white text-gray-500 hover:border-gray-300 uppercase tracking-widest">Flokkar</button>
            </div>
        </div>

        <!-- Matseðils-grid -->
        <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[400px]">
        </div>

        <!-- Auglýsing -->
        <section class="mt-20 relative rounded-3xl overflow-hidden shadow-2xl group">
            <img src="https://images.prismic.io/worldclass/aWEQsgIvOtkhBOhn_WC%2B_Salatbar2.jpg?" alt="Heilsutvenna" class="w-full h-auto object-cover transition-transform duration-700 group-hover:scale-105">
            <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
        </section>
        
        <footer class="mt-20 text-center pb-12">
            <p class="text-gray-300 text-[10px] font-bold tracking-[0.3em] uppercase">World Class 2026</p>
        </footer>
    </div>

    <!-- Upplýsingagluggi (Modal) -->
    <div id="item-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4 bg-gray-950/40 backdrop-blur-sm transition-opacity duration-300" onclick="closeModal()">
        <div class="bg-white rounded-[2.5rem] shadow-2xl max-w-md w-full overflow-hidden transform scale-95 opacity-0 transition-all duration-300 relative" id="modal-content" onclick="event.stopPropagation()">
            
            <!-- Controls -->
            <div class="absolute top-6 right-6 z-20 flex gap-2" id="modal-controls">
                <button id="share-btn" onclick="shareAsImage()" class="bg-white/80 backdrop-blur p-2.5 rounded-full hover:bg-white transition-all text-gray-400 hover:text-blue-500 border border-gray-100 shadow-sm active:scale-95">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                    </svg>
                </button>
                <button onclick="closeModal()" class="bg-white/80 backdrop-blur p-2.5 rounded-full hover:bg-white transition-all text-gray-400 hover:text-red-500 border border-gray-100 shadow-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- Screenshot Area -->
            <div class="p-8 sm:p-10 bg-white relative rounded-[2.5rem]" id="share-capture-area">
                
                <div class="flex items-center justify-between mb-8 h-10">
                    <div class="flex items-center gap-2">
                        <span id="modal-tag" class="text-[9px] font-extrabold px-3 pt-2.5 pb-2 inline-flex items-center justify-center rounded-lg text-white uppercase tracking-widest leading-none border-b-2 border-black/5"></span>
                        <span id="modal-vegan" class="hidden text-[9px] font-extrabold px-3 pt-2.5 pb-2 inline-flex items-center justify-center bg-green-500/10 text-green-600 rounded-lg uppercase tracking-widest border border-green-500/20 leading-none">Vegan</span>
                    </div>

                    <div id="screenshot-logo-wrapper" class="hidden">
                        <img src="https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress&w=600" alt="Logo" class="h-10 w-auto opacity-90 block">
                    </div>
                </div>
                
                <h2 id="modal-title" class="text-3xl font-black text-gray-900 leading-tight mb-4 pr-10"></h2>
                
                <div id="modal-price-container" class="mb-8"></div>

                <div class="mb-8">
                    <h4 id="label-ingredients" class="text-[9px] font-black uppercase tracking-[0.2em] text-gray-300 mb-2">Innihaldslýsing</h4>
                    <p id="modal-description" class="text-gray-600 leading-relaxed text-sm font-medium"></p>
                </div>

                <div class="space-y-6">
                    <div id="modal-nutrition-section" class="bg-gray-50/50 rounded-[2rem] p-6 border border-gray-100/50 hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h4 id="label-nutrition" class="text-[9px] font-black uppercase tracking-[0.2em] text-gray-300">Næringargildi</h4>
                            <div id="modal-sizes" class="flex gap-1"></div>
                        </div>
                        
                        <div class="flex items-center justify-between gap-8 mb-2">
                            <div class="relative flex-shrink-0">
                                <svg width="140" height="140" viewBox="0 0 150 150" style="transform: rotate(-90deg);" class="block">
                                    <circle cx="75" cy="75" r="65" stroke="#f3f4f6" stroke-width="14" fill="transparent" />
                                    <circle id="circle-protein" cx="75" cy="75" r="65" stroke="#f87171" stroke-width="14" fill="transparent" 
                                        stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                    <circle id="circle-carbs" cx="75" cy="75" r="65" stroke="#fdba74" stroke-width="14" fill="transparent" 
                                        stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                    <circle id="circle-fat" cx="75" cy="75" r="65" stroke="#7dd3fc" stroke-width="14" fill="transparent" 
                                        stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                    <span id="val-kcal-center" class="text-3xl font-black text-gray-900 leading-none">0</span>
                                    <span class="text-[8px] font-black uppercase tracking-widest text-gray-400 mt-1">kcal</span>
                                </div>
                            </div>

                            <div id="modal-macros" class="flex-grow flex flex-col gap-3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        const IS_LANG = {
            tagline: 'þín orka, þinn árangur.',
            labelIngredients: 'Innihaldslýsing',
            labelNutrition: 'Næringargildi',
            labelSortBy: 'Raða eftir:',
            sortKcal: 'Kcal',
            sortProtein: 'Prótein',
            sortCarbs: 'Kolvetni',
            sortFat: 'Fita',
            sortCategory: 'Flokkar',
            noResults: 'Engar niðurstöður fundust.',
            kcal: 'kcal', protein: 'prótein', fat: 'fita', carbs: 'kolvetni',
            noMacros: 'Næringargildi ekki tilgreind.',
            S: 'Lítill', M: 'Mið', L: 'Stór',
            sharing: 'Bý til...',
            imageCreated: 'Mynd búin til!'
        };

        const EN_LANG = {
            tagline: 'Your energy, your success.',
            labelIngredients: 'Ingredients',
            labelNutrition: 'Nutrition Facts',
            labelSortBy: 'Sort by:',
            sortKcal: 'Calories',
            sortProtein: 'Protein',
            sortCarbs: 'Carbs',
            sortFat: 'Fat',
            sortCategory: 'Categories',
            noResults: 'No items found.',
            kcal: 'kcal', protein: 'protein', fat: 'fat', carbs: 'carbs',
            noMacros: 'Nutrition facts not available.',
            S: 'Small', M: 'Medium', L: 'Large',
            sharing: 'Creating...',
            imageCreated: 'Image created!'
        };

        const THEMES = {
            LIGHT: { key: 'LIGHT', is: 'Light', en: 'Light', color: '#34d399', descIs: 'Létt og næringarríkt', descEn: 'Light & Nutritious' },
            BALANCE: { key: 'BALANCE', is: 'Balance', en: 'Balance', color: '#38bdf8', descIs: 'Einbeiting og jafnvægi', descEn: 'Focus & Balance' },
            ENERGY: { key: 'ENERGY', is: 'Energy', en: 'Energy', color: '#fb923c', descIs: 'Kraftur fyrir daginn', descEn: 'Power for your day' },
            STRENGTH: { key: 'STRENGTH', is: 'Strength', en: 'Strength', color: '#ef4444', descIs: 'Byggðu upp líkamann', descEn: 'Build your body' }
        };

        const CATEGORIES = {
            'DRYKKIR': { is: 'Drykkir', en: 'Drinks', img: 'https://images.prismic.io/worldclass/aVxY43NYClf9ozUz_menu_21920.jpg?auto=format,compress' },
            'SALAT': { is: 'Salöt', en: 'Salads', img: 'https://images.prismic.io/worldclass/aVxTN3NYClf9ozUA_menu_11920.jpg' },
            'GRAUTUR': { is: 'Grautar', en: 'Porridge', img: 'https://images.prismic.io/worldclass/aVxTOnNYClf9ozUD_menu_41920.jpg' },
            'KRISP': { is: 'Krisp', en: 'Crisp', img: 'https://images.prismic.io/worldclass/aVxTOXNYClf9ozUC_menu_31920.jpg' },
            'SKOT': { is: 'Skot', en: 'Shots', img: 'https://images.prismic.io/worldclass/aXQ3CAIvOtkhB5aW_skot.jpg' },
            'BÖRN': { is: 'Börn', en: 'Kids', img: 'https://images.prismic.io/worldclass/aVxTOHNYClf9ozUB_menu_21920.jpg' },
            'KAFFI': { is: 'Kaffi', en: 'Coffee', img: 'https://kitchenaid.com.au/cdn/shop/articles/Untitled_design_22_a34b9e85-b904-4444-b67b-c0cb895357ea.png?v=1728611009' },
            'GRÍPTU MEÐ': { is: 'Gríptu með', en: 'Grab & Go', img: 'https://images.prismic.io/worldclass/aXQ2UQIvOtkhB5aU_gripamed.jpg?auto=format,compress' }
        };

        const rawData = [
            // DRYKKIR
            { category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Kraftur', nameEn: 'Power', descriptionIs: 'Vanillu skyr, banani, jarðarber og prótein.', descriptionEn: 'Vanilla Skyr, banana, strawberries and protein powder.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:282, protein:26, fat:1, carbs:36}, M:{kcal:314, protein:29, fat:2, carbs:40}, L:{kcal:345, protein:32, fat:2, carbs:44} } },
            { category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Prótein ískaffi', nameEn: 'Protein Iced Coffee', descriptionIs: 'Tvöfaldur espresso, möndlumjólk, ólífuolía og prótein.', descriptionEn: 'Double espresso, almond milk and protein powder.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:154, protein:26, fat:4, carbs:1}, M:{kcal:172, protein:29, fat:4, carbs:1}, L:{kcal:189, protein:32, fat:5, carbs:2} } },
            { category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Snerpa', nameEn: 'Vigor', descriptionIs: 'Jarðarber, banani, epli og Amino Energy.', descriptionEn: 'Strawberries, banana, apple and Amino Energy.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:232, protein:1, fat:0, carbs:54}, M:{kcal:258, protein:1, fat:1, carbs:60}, L:{kcal:283, protein:1, fat:1, carbs:66} }, isVegan: true },
            { category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Gleði', nameEn: 'Joy', descriptionIs: 'Sítróna, engifer, jarðarber, epli og jarðarberjaprótein.', descriptionEn: 'Lemon, ginger, apple and strawberry protein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:227, protein:24, fat:1, carbs:28}, M:{kcal:253, protein:27, fat:2, carbs:31}, L:{kcal:278, protein:29, fat:2, carbs:34} } },
            { category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Líf', nameEn: 'Life', descriptionIs: 'Avókadó, epli, ananas og engifer.', descriptionEn: 'Avocado, apple, pineapple and ginger.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:216, protein:1, fat: 8, carbs: 35}, M:{kcal:241, protein:1, fat: 10, carbs: 43}, L:{kcal:216, protein:1, fat: 12, carbs: 51} }, isVegan: true },
            { category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Endurnýjun', nameEn: 'Renewal', descriptionIs: 'Rauðrófusafi, avókadó, sellerí, epli og sítróna.', descriptionEn: 'Beetroot juice, avocado, celery and lemon.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:255, protein:1, fat:1, carbs:57}, M:{kcal:284, protein:1, fat:1, carbs:64}, L:{kcal:312, protein:1, fat:1, carbs:70} }, isVegan: true },
            { category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Græn heilsa', nameEn: 'Green Health', descriptionIs: 'Spínat, mangó, epli, sellerí og collagen.', descriptionEn: 'Spinach, mango, apple and collagen.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:180, protein:12, fat:1, carbs:27}, M:{kcal:200, protein:13, fat:1, carbs:30}, L:{kcal:180, protein:12, fat:1, carbs:27} } },
            { category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Brennsla', nameEn: 'Metabolism', descriptionIs: 'Epli, mangó, bláber, engifer og prótein.', descriptionEn: 'Apple, mango, blueberries and protein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:283, protein:23, fat:1, carbs:43}, M:{kcal:300, protein:25, fat:1, carbs:48}, L:{kcal:347, protein:28, fat: 2, carbs: 53} } },
            { category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Upphitun', nameEn: 'Warm-up', descriptionIs: 'Vanillu skyr, jarðarber, mangó og ananas.', descriptionEn: 'Vanilla Skyr, strawberries and mango.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:177, protein:11, fat:2, carbs:30}, M:{kcal:197, protein:12, fat:2, carbs:33}, L:{kcal:216, protein:13, fat:2, carbs:37} } },
            { category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Massi', nameEn: 'Bulk', descriptionIs: 'Jarðarber, döðlur, hnetusmjör og prótein.', descriptionEn: 'Strawberries, dates and protein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:636, protein:39, fat:31, carbs:61}, M:{kcal:707, protein:44, fat:35, carbs:68}, L:{kcal:778, protein:48, fat:38, carbs:75} } },
            { category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Orka', nameEn: 'Energy', descriptionIs: 'Banani, haframjöl, haframjólk, möndlusmjör og prótein.', descriptionEn: 'Banana, oatmeal and protein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:833, protein:44, fat:38, carbs:86}, M:{kcal:926, protein:49, fat:42, carbs:95}, L:{kcal:1018, protein:53, fat: 46, carbs: 105} } },
            { category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Berjabomba', nameEn: 'Berry Bomb', descriptionIs: 'Hindber, bláber, ólífuolía, kókosmjólk og prótein.', descriptionEn: 'Berries and protein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:778, protein:24, fat:67, carbs:21}, M:{kcal:865, protein:27, fat:75, carbs:24}, L:{kcal:951, protein:29, fat: 82, carbs: 26} } },

            // SALAT
            { category: 'SALAT', theme: 'ENERGY', nameIs: 'Energy salat', nameEn: 'Energy Salad', price: '2.190 kr', descriptionIs: 'Pestó pasta, tómatar, spínat, döðlur, kasjúhnetur og fetaostur.', descriptionEn: 'Pesto pasta, spinach, dates and feta.', macros: { kcal: 991, protein: 32, fat: 49, carbs: 102 } },
            { category: 'SALAT', theme: 'STRENGTH', nameIs: 'Strength salat', nameEn: 'Strength Salad', price: '2.190 kr', descriptionIs: 'Kjúklingur, pasta, vínber, döðlur, parmesanostur og World Class+ dressing.', descriptionEn: 'Chicken, pasta and Parmesan.', macros: { kcal: 905, protein: 57, fat: 33, carbs: 97 } },
            { category: 'SALAT', theme: 'BALANCE', nameIs: 'Balance salat', nameEn: 'Balance Salad', price: '2.190 kr', descriptionIs: 'Salat, grænmetisbuff, avocado, rauðlaukur, gúrka, tómatar og frönsk dressing.', descriptionEn: 'Veggie patty and avocado.', macros: { kcal: 424, protein: 11, fat: 27, carbs: 39 }, isVegan: true },
            { category: 'SALAT', theme: 'LIGHT', nameIs: 'Light salat', nameEn: 'Light Salad', price: '1.890 kr', descriptionIs: 'Salat, túnfiskur, egg, rauðlaukur, gúrka og kotasæludressing.', descriptionEn: 'Tuna, egg and cucumber.', macros: { kcal: 452, protein: 48, fat: 16, carbs: 14 } },

            // GRAUTUR
            { category: 'GRAUTUR', theme: 'ENERGY', nameIs: 'Energy Grautur', nameEn: 'Energy Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og Cookies & Cream prótein. Toppað með: möndlusmjör, bláber, jarðarber og banani.', descriptionEn: 'Almond milk, oats and protein.', macros: { kcal: 720, protein: 42, fat: 13, carbs: 110 } },
            { category: 'GRAUTUR', theme: 'STRENGTH', nameIs: 'Strength Grautur', nameEn: 'Strength Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og vanillu prótein. Toppað með: hnetusmjör, banani, döðlur og bláber.', descriptionEn: 'Almond milk, oats and protein.', macros: { kcal: 731, protein: 44, fat: 14, carbs: 115 } },
            { category: 'GRAUTUR', theme: 'BALANCE', nameIs: 'Balance Grautur', nameEn: 'Balance Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og collagen. Toppað með: hampfræ, bláber, döðlur og jarðarber.', descriptionEn: 'Almond milk, oats and collagen.', macros: { kcal: 680, protein: 42, fat: 8, carbs: 113 } },
            { category: 'GRAUTUR', theme: 'LIGHT', nameIs: 'Light Grautur', nameEn: 'Light Porridge', price: '890 kr', descriptionIs: 'Möndlumjólk, hafrar og hunang. Toppað með: hampfræ, jarðarber, kókosflögur og bláber.', descriptionEn: 'Almond milk, oats and seeds.', macros: { kcal: 524, protein: 15, fat: 14, carbs: 87 } },

            // KRISP
            { category: 'KRISP', theme: 'ENERGY', nameIs: 'Kjúklinga & avókadó krisp', nameEn: 'Chicken & Avocado Crisp', price: '1.290 kr', descriptionIs: '4x Finn Crisp, kjúklingur, avókadó og sesamfræ.', descriptionEn: 'Crisp bread with chicken and avocado.', macros: { kcal: 321, protein: 28, fat: 20, carbs: 8 } },
            { category: 'KRISP', theme: 'STRENGTH', nameIs: 'Túnfisk & egg krisp', nameEn: 'Tuna & Egg Crisp', price: '1.290 kr', descriptionIs: '4x Finn Crisp og túnfisksalat.', descriptionEn: 'Crisp bread with tuna salad.', macros: { kcal: 334, protein: 32, fat: 15, carbs: 21 } },
            { category: 'KRISP', theme: 'BALANCE', nameIs: 'Hummus krisp', nameEn: 'Hummus Crisp', price: '1.190 kr', descriptionIs: '4x Finn Crisp, hummus og tómatar.', descriptionEn: 'Crisp bread with hummus and tomatoes.', macros: { kcal: 318, protein: 12, fat: 8, carbs: 60 }, isVegan: true },
            { category: 'KRISP', theme: 'LIGHT', nameIs: 'Kjúklinga krisp', nameEn: 'Chicken Crisp', price: '1.190 kr', descriptionIs: '4x Finn Crisp, kjúklingasalat og tómatar.', descriptionEn: 'Crisp bread with chicken salad.', macros: { kcal: 316, protein: 29, fat: 12, carbs: 20 } },

            // SKOT
            { category: 'SKOT', theme: 'ENERGY', nameIs: 'Orkuskot', nameEn: 'Energy Shot', price: '450 kr', descriptionIs: 'Rauðrófa, túrmerik, engifer, sítróna og epli.', descriptionEn: 'Beetroot, turmeric, ginger, lemon and apple.', isVegan: true },
            { category: 'SKOT', theme: 'STRENGTH', nameIs: 'Kraftskot', nameEn: 'Power Shot', price: '450 kr', descriptionIs: 'Kreatín og epli.', descriptionEn: 'Creatine and apple.', isVegan: true },
            { category: 'SKOT', theme: 'LIGHT', nameIs: 'Ofurskot', nameEn: 'Super Shot', price: '450 kr', descriptionIs: 'Túrmerik, engifer, sítróna, epli og kanill.', descriptionEn: 'Turmeric, ginger, lemon and apple.', isVegan: true },
            { category: 'SKOT', theme: 'BALANCE', nameIs: 'Spirulína', nameEn: 'Spirulina', price: '350 kr', descriptionIs: 'Hreint spirulína skot.', descriptionEn: 'Pure spirulina shot.', isVegan: true },
            { category: 'SKOT', theme: 'BALANCE', nameIs: 'Engifer', nameEn: 'Ginger', price: '350 kr', descriptionIs: 'Hreint engiferskot.', descriptionEn: 'Pure ginger shot.', isVegan: true },
            { category: 'SKOT', theme: 'BALANCE', nameIs: 'Túrmerik', nameEn: 'Turmeric', price: '350 kr', descriptionIs: 'Hreint túrmerikskot.', descriptionEn: 'Pure turmeric shot.', isVegan: true },
            { category: 'SKOT', theme: 'BALANCE', nameIs: 'Rauðrófa', nameEn: 'Beetroot', price: '350 kr', descriptionIs: 'Hreint rauðrófuskot.', descriptionEn: 'Pure beetroot shot.', isVegan: true },

            // BÖRN
            { category: 'BÖRN', theme: 'ALL', nameIs: 'Jarðarberjaboost', nameEn: 'Strawberry Boost', price: '890 kr', descriptionIs: 'Jarðarber, banani og epli.', descriptionEn: 'Strawberry, banana and apple.', isVegan: true },
            { category: 'BÖRN', theme: 'ALL', nameIs: 'Bláberjaboost', nameEn: 'Blueberry Boost', price: '890 kr', descriptionIs: 'Bláber, banani og epli.', descriptionEn: 'Blueberry, banana and apple.', isVegan: true },
            { category: 'BÖRN', theme: 'ALL', nameIs: 'Fruit minis', nameEn: 'Fruit Minis', price: '190 kr', descriptionIs: 'Smábitar með hindberja og bláberjabragði.', descriptionEn: 'Small fruit bites.', isVegan: true },
            { category: 'BÖRN', theme: 'ALL', nameIs: 'BEAR ávaxtarúlla', nameEn: 'BEAR Fruit Roll', price: '190 kr', descriptionIs: 'Jarðarberja ávaxtarúlla.', descriptionEn: 'Strawberry fruit roll.', isVegan: true },

            // KAFFI
            { category: 'KAFFI', theme: 'ALL', nameIs: 'Americano', nameEn: 'Americano', price: '500 kr', descriptionIs: 'Svart kaffi úr nýmöluðum baunum.', descriptionEn: 'Fresh black coffee.', isVegan: true },
            { category: 'KAFFI', theme: 'ALL', nameIs: 'Espresso', nameEn: 'Espresso', price: '500 kr', descriptionIs: 'Sterkt kaffiskot.', descriptionEn: 'Strong coffee shot.', isVegan: true },
            { category: 'KAFFI', theme: 'ALL', nameIs: 'Latte', nameEn: 'Caffè Latte', price: '500 kr', descriptionIs: 'Milt kaffi með mikilli flóaðri mjólk.', descriptionEn: 'Mild coffee with milk.' },

            // GRÍPTU MEÐ
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Harðfiskur', nameEn: 'Dried Fish', price: '990 kr', descriptionIs: 'Hágæða íslenskur harðfiskur.', descriptionEn: 'Premium dried fish.' },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Prótein muffins', nameEn: 'Protein Muffin', price: '590 kr', descriptionIs: 'Próteinrík muffins-kaka.', descriptionEn: 'High-protein muffin.' },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Hnetumix', nameEn: 'Nut Mix', price: '390 kr', descriptionIs: 'Blanda af völdum hnetum.', descriptionEn: 'Assorted nut mix.', isVegan: true },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Egg', nameEn: 'Egg', price: '250 kr', descriptionIs: 'Eitt soðið egg.', descriptionEn: 'Hard boiled egg.' },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Epli', nameEn: 'Apple', price: '150 kr', descriptionIs: 'Ferskt epli.', descriptionEn: 'Fresh apple.', isVegan: true },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Banani', nameEn: 'Banana', price: '170 kr', descriptionIs: 'Ferskur banani.', descriptionEn: 'Fresh banana.', isVegan: true }
        ];

        let state = { isIcelandic: true, activeCategory: 'DRYKKIR', activeTheme: null, selectedSize: 'M', modalItem: null, sortBy: 'category' };
        const getLang = () => state.isIcelandic ? IS_LANG : EN_LANG;

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.textContent = message;
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function updateToggleVisual() {
            const dot = document.getElementById('toggle-dot');
            const labelIsPlain = document.getElementById('lang-label-is-plain');
            const labelEn = document.getElementById('lang-label-en');
            if (state.isIcelandic) {
                dot.style.transform = 'translateX(0)';
                labelIsPlain.classList.replace('text-gray-400', 'text-red-500');
                labelEn.classList.replace('text-red-500', 'text-gray-400');
            } else {
                dot.style.transform = 'translateX(1.25rem)';
                labelIsPlain.classList.replace('text-red-500', 'text-gray-400');
                labelEn.classList.replace('text-gray-400', 'text-red-500');
            }
        }

        function toggleLanguage() {
            state.isIcelandic = !state.isIcelandic;
            updateToggleVisual();
            render();
            if (state.modalItem) openModal(rawData.indexOf(state.modalItem));
        }

        function setActiveCategory(cat) {
            state.activeCategory = cat; state.activeTheme = null; render();
            const btn = document.querySelector(`[data-cat-btn="${cat}"]`);
            if (btn) btn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }

        function toggleTheme(themeKey) { state.activeTheme = (state.activeTheme === themeKey) ? null : themeKey; render(); }
        function setSort(type) { state.sortBy = type; render(); }

        function updateCategoryScroll() {
            const nav = document.getElementById('category-tabs');
            const thumb = document.getElementById('category-scroll-thumb');
            if(!thumb || !nav) return;
            const scrollPercent = nav.scrollLeft / (nav.scrollWidth - nav.clientWidth || 1);
            thumb.style.transform = `translateX(${scrollPercent * 233}%)`;
        }

        function render() {
            const lang = getLang();
            document.getElementById('tagline').textContent = lang.tagline;
            document.getElementById('sort-label').textContent = lang.labelSortBy;
            ['kcal', 'protein', 'carbs', 'fat', 'category'].forEach(s => {
                const btn = document.getElementById(`sort-${s}`);
                if (btn) btn.textContent = lang[`sort${s.charAt(0).toUpperCase() + s.slice(1)}`];
            });
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(`sort-${state.sortBy}`);
            if(activeBtn) activeBtn.classList.add('active');
            renderNav(); renderThemeButtons(); renderHero(); renderGrid();
            setTimeout(updateCategoryScroll, 50);
        }

        function renderNav() {
            const container = document.getElementById('category-tabs');
            container.innerHTML = Object.entries(CATEGORIES).map(([key, info]) => {
                const active = state.activeCategory === key && !state.activeTheme;
                return `<button onclick="setActiveCategory('${key}')" data-cat-btn="${key}" class="category-tab px-6 py-2.5 rounded-xl text-[10px] font-extrabold uppercase tracking-[0.2em] transition-all ${active ? 'bg-red-500 text-white shadow-md shadow-red-200' : 'bg-transparent text-gray-400 hover:text-gray-600'}">${state.isIcelandic ? info.is : info.en}</button>`;
            }).join('');
        }

        function renderThemeButtons() {
            const container = document.getElementById('theme-filters');
            container.innerHTML = Object.values(THEMES).map(t => {
                const active = state.activeTheme === t.key;
                return `<button onclick="toggleTheme('${t.key}')" class="theme-btn text-left p-3.5 rounded-[1.2rem] flex flex-row items-center gap-3 bg-white border border-gray-100 transition-all ${active ? 'ring-2 ring-offset-2 ring-gray-100 shadow-xl scale-[1.02]' : 'hover:bg-gray-50'}" style="color: ${t.color}">
                    <div class="w-2.5 h-2.5 rounded-full flex-shrink-0" style="background-color: ${t.color}"></div>
                    <div class="flex flex-col">
                        <h5 class="text-[10px] font-black uppercase tracking-widest leading-none mb-1 text-gray-900">${state.isIcelandic ? t.is : t.en}</h5>
                        <p class="text-[9px] text-gray-400 leading-tight font-medium">${state.isIcelandic ? t.descIs : t.descEn}</p>
                    </div>
                </button>`;
            }).join('');
        }

        function renderHero() {
            const hero = document.getElementById('category-hero');
            const heroImg = document.getElementById('hero-img');
            const heroTitle = document.getElementById('hero-title');
            const overlay = document.getElementById('hero-color-overlay');
            let newSrc = "", newTitle = "", newColor = "", newOpacity = "0";
            if (state.activeTheme) {
                const t = THEMES[state.activeTheme]; newSrc = "https://images.prismic.io/worldclass/aVxTO3NYClf9ozUE_menu1920.jpg"; newTitle = state.isIcelandic ? t.is : t.en; newColor = t.color; newOpacity = '0.5';
            } else {
                const c = CATEGORIES[state.activeCategory]; if (c) { newSrc = c.img; newTitle = state.isIcelandic ? c.is : c.en; }
            }
            if (newSrc) { hero.classList.remove('hidden'); heroImg.src = newSrc; heroTitle.textContent = newTitle; overlay.style.backgroundColor = newColor; overlay.style.opacity = newOpacity; } else { hero.classList.add('hidden'); }
        }

        function renderGrid() {
            const container = document.getElementById('menu-grid');
            const lang = getLang();
            let items = [...rawData];
            
            if (state.activeTheme) {
                items = items.filter(i => i.theme === state.activeTheme || i.theme === 'ALL');
            } else {
                items = items.filter(i => i.category === state.activeCategory);
            }
            
            if (['kcal', 'protein', 'carbs', 'fat'].includes(state.sortBy)) {
                items.sort((a, b) => {
                    const getVal = (item, key) => { if (!item.macros) return 0; const m = item.prices ? item.macros.M : item.macros; return m[key] || 0; };
                    return getVal(b, state.sortBy) - getVal(a, state.sortBy);
                });
            }
            
            if (items.length === 0) { container.innerHTML = `<div class="col-span-full py-20 text-center text-gray-300 font-bold uppercase tracking-widest">${getLang().noResults}</div>`; return; }
            
            container.innerHTML = items.map((item) => {
                const theme = THEMES[item.theme] || { is: 'All', en: 'All', color: '#9ca3af' };
                const price = item.prices ? item.prices.M : item.price;
                const macros = item.macros ? (item.prices ? item.macros.M : item.macros) : null;
                
                let dynamicLabel = "";
                if (macros && ['kcal', 'protein', 'carbs', 'fat'].includes(state.sortBy)) {
                    const val = macros[state.sortBy];
                    const unit = state.sortBy === 'kcal' ? ` ${lang.kcal}` : `g ${lang[state.sortBy]}`;
                    dynamicLabel = `<span class="text-[8px] font-bold px-2 py-0.5 bg-gray-50 text-gray-400 rounded-md uppercase tracking-widest">${val}${unit}</span>`;
                } else if (macros) {
                    dynamicLabel = `<span class="text-[8px] font-bold px-2 py-0.5 bg-gray-50 text-gray-400 rounded-md uppercase tracking-widest">${macros.kcal} ${lang.kcal}</span>`;
                }

                return `<div class="item-card bg-white p-7 rounded-[2rem] border border-gray-50 shadow-sm cursor-pointer animate-slide-up flex flex-col h-full" onclick="openModal(${rawData.indexOf(item)})">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex flex-wrap gap-2">
                            <span class="text-[8px] font-black px-2 py-0.5 rounded-md text-white uppercase tracking-widest" style="background-color: ${theme.color}">${state.isIcelandic ? theme.is : theme.en}</span>
                            ${item.isVegan ? '<span class="text-[8px] font-black px-2 py-0.5 rounded-md bg-green-500/10 text-green-600 uppercase tracking-widest border border-green-500/20">Vegan</span>' : ''}
                            ${dynamicLabel}
                        </div>
                        <span class="text-xs font-black text-red-500 tracking-tight whitespace-nowrap">${price}</span>
                    </div>
                    <h3 class="text-lg font-extrabold text-gray-900 mb-2 tracking-tight leading-tight">${state.isIcelandic ? item.nameIs : item.nameEn}</h3>
                    <p class="text-gray-400 text-xs leading-relaxed font-medium mt-auto line-clamp-2">${state.isIcelandic ? item.descriptionIs : item.descriptionEn}</p>
                </div>`;
            }).join('');
        }

        function animateSynchronized(macros) {
            const p = macros.protein || 0, c = macros.carbs || 0, f = macros.fat || 0, total = p + c + f || 1;
            const circum = 408.4;
            const cP = document.getElementById('circle-protein'), cC = document.getElementById('circle-carbs'), cF = document.getElementById('circle-fat'), valK = document.getElementById('val-kcal-center');
            const pR = p / total, cR = c / total, fR = f / total;
            [cP, cC, cF].forEach(circle => { circle.style.strokeDashoffset = circum; });
            cP.style.transform = 'rotate(0deg)'; cC.style.transform = `rotate(${pR * 360}deg)`; cF.style.transform = `rotate(${(pR + cR) * 360}deg)`;
            setTimeout(() => {
                cP.style.strokeDashoffset = circum - (pR * circum); cC.style.strokeDashoffset = circum - (cR * circum); cF.style.strokeDashoffset = circum - (fR * circum);
                let end = macros.kcal || 0, dur = 800, startT = null;
                function step(t) { if (!startT) startT = t; let prog = Math.min((t - startT) / dur, 1); valK.textContent = Math.floor(prog * end); if (prog < 1) requestAnimationFrame(step); else valK.textContent = end; }
                requestAnimationFrame(step);
                ['protein', 'carbs', 'fat'].forEach(key => document.getElementById(`val-${key}`).textContent = macros[key] + 'g');
            }, 50);
        }

        async function shareAsImage() {
            const shareBtn = document.getElementById('share-btn');
            const captureArea = document.getElementById('share-capture-area');
            const item = state.modalItem; if (!item) return;
            const originalBtn = shareBtn.innerHTML;
            shareBtn.innerHTML = `<svg class="w-5 h-5 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" stroke-width="2" stroke-linecap="round"/></svg>`;
            
            try {
                const canvas = await html2canvas(captureArea, {
                    backgroundColor: null, 
                    scale: 3, 
                    useCORS: true,
                    logging: false,
                    onclone: (clonedDoc) => {
                        const area = clonedDoc.getElementById('share-capture-area');
                        const logo = clonedDoc.getElementById('screenshot-logo-wrapper');
                        const prices = clonedDoc.getElementById('modal-price-container');
                        const controls = clonedDoc.getElementById('modal-controls');
                        
                        area.style.backgroundColor = 'white';
                        area.style.borderRadius = '2.5rem';
                        area.style.width = '420px';
                        area.style.paddingTop = '40px';
                        area.style.boxShadow = 'none';

                        if (logo) logo.style.display = 'block';
                        if (prices) prices.style.display = 'none';
                        if (controls) controls.style.display = 'none';

                        const svg = area.querySelector('svg');
                        if (svg) { svg.style.transform = 'rotate(-90deg)'; svg.style.display = 'block'; }
                    }
                });

                canvas.toBlob(async (blob) => {
                    const file = new File([blob], `worldclass-${item.nameIs.toLowerCase()}.png`, { type: 'image/png' });
                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({ files: [file], title: 'World Class+' });
                    } else {
                        const link = document.createElement('a');
                        link.download = `worldclass-${item.nameIs.toLowerCase()}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                        showToast(getLang().imageCreated);
                    }
                    shareBtn.innerHTML = originalBtn;
                }, 'image/png');
            } catch (err) { shareBtn.innerHTML = originalBtn; }
        }

        function openModal(idx) {
            const item = rawData[idx]; state.modalItem = item; state.selectedSize = item.prices ? 'M' : null;
            const content = document.getElementById('modal-content');
            const theme = THEMES[item.theme] || { is: 'Standard', en: 'Standard', color: '#9ca3af' };
            document.getElementById('modal-title').textContent = state.isIcelandic ? item.nameIs : item.nameEn;
            document.getElementById('modal-description').textContent = state.isIcelandic ? item.descriptionIs : item.descriptionEn;
            document.getElementById('label-ingredients').textContent = getLang().labelIngredients;
            document.getElementById('label-nutrition').textContent = getLang().labelNutrition;
            const tag = document.getElementById('modal-tag');
            tag.textContent = state.isIcelandic ? theme.is : theme.en;
            tag.style.backgroundColor = theme.color;
            document.getElementById('modal-vegan').style.display = item.isVegan ? 'inline-flex' : 'none';
            updateModalUI();
            document.getElementById('item-modal').classList.replace('hidden', 'flex');
            setTimeout(() => { content.classList.replace('scale-95', 'scale-100'); content.classList.replace('opacity-0', 'opacity-100'); }, 10);
        }

        function updateModalUI() {
            const item = state.modalItem, lang = getLang();
            const pContainer = document.getElementById('modal-price-container'), nSection = document.getElementById('modal-nutrition-section');
            if (item.prices) pContainer.innerHTML = `<div class="grid grid-cols-3 gap-2">${Object.entries(item.prices).map(([size, price]) => `<button onclick="changeSize('${size}')" class="flex flex-col items-center py-2.5 px-3 rounded-2xl border transition-all ${state.selectedSize === size ? 'border-red-400 bg-red-50/50 text-red-500 font-bold' : 'border-gray-100 text-gray-400 font-medium'}"><span class="text-[8px] font-black uppercase tracking-widest mb-0.5">${lang[size]}</span><span class="text-xs">${price}</span></button>`).join('')}</div>`;
            else pContainer.innerHTML = `<span class="text-3xl font-black text-red-500 tracking-tight">${item.price}</span>`;
            const macros = item.macros ? (item.prices ? item.macros[state.selectedSize] : item.macros) : null;
            if (macros) {
                nSection.classList.remove('hidden');
                const styles = { protein: { bg: 'bg-red-500/5', l: lang.protein, c: 'text-red-500' }, carbs: { bg: 'bg-orange-500/5', l: lang.carbs, c: 'text-orange-500' }, fat: { bg: 'bg-sky-500/5', l: lang.fat, c: 'text-sky-600' } };
                document.getElementById('modal-macros').innerHTML = Object.entries(styles).map(([key, s]) => `<div class="${s.bg} px-4 py-3 rounded-2xl flex items-center justify-between border border-gray-100/10"><span class="text-[8px] font-black uppercase tracking-widest pt-0.5 ${s.c}">${s.l}</span><span id="val-${key}" class="text-sm font-black text-gray-800">0g</span></div>`).join('');
                animateSynchronized(macros);
            } else nSection.classList.add('hidden');
        }

        function changeSize(size) { state.selectedSize = size; updateModalUI(); }
        function closeModal() {
            const m = document.getElementById('item-modal'), c = document.getElementById('modal-content');
            c.classList.replace('scale-100', 'scale-95'); c.classList.replace('opacity-100', 'opacity-0');
            setTimeout(() => m.classList.replace('flex', 'hidden'), 300);
        }
        window.onload = () => { render(); updateToggleVisual(); };
    </script>
</body>
</html>
