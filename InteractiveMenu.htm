<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Class+ Menu</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #ef4444; 
            --secondary: #111827;
            --background: #fafafa;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--secondary);
            -webkit-tap-highlight-color: transparent;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.06);
        }

        .item-card {
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0;
            transform: translateY(25px);
        }
        .item-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .item-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 35px -8px rgba(0, 0, 0, 0.08);
        }

        .category-tab, .sort-btn {
            position: relative;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-transform: uppercase;
            font-weight: 800;
            z-index: 10;
        }

        .category-tab {
            letter-spacing: 0.12em;
            font-size: 0.65rem;
            padding: 0.6rem 0.75rem;
        }

        .active-tab { color: white !important; }

        #nav-indicator, #sort-indicator {
            position: absolute;
            background-color: var(--primary);
            border-radius: 9999px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
            z-index: 1;
            pointer-events: none;
        }

        #nav-indicator { height: 34px; }
        #sort-indicator { height: 28px; top: 4px; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .logo-animated {
            width: 240px;
            height: 52px;
            background: linear-gradient(45deg, #ef4444, #ef4444, #ef4444, #facc15, #38bdf8, #ef4444);
            background-size: 300% 300%;
            -webkit-mask: url("https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress") no-repeat center;
            mask: url("https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            animation: logoGradientFlow 8s ease infinite;
        }

        @keyframes logoGradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .macro-circle { transform-origin: center; }
        
        .search-container { transition: all 0.3s ease; }
        .search-container:focus-within {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-color: #ef4444;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            width: 200px;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
            z-index: 100;
        }
        .dropdown-menu.active { display: block; }

        .card-macro-grid {
            border-top: 1px solid rgba(243, 244, 246, 1);
            padding-top: 1rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="antialiased selection:bg-red-100 selection:text-red-600">

    <div class="max-w-4xl mx-auto px-4 pt-6 pb-8 sm:pt-12">
        
        <!-- Haus -->
        <header class="flex flex-col items-center mb-10 sm:mb-16">
            <div class="w-full flex justify-end items-center gap-3 mb-10">
                
                <!-- Location Dropdown -->
                <div class="relative">
                    <button onclick="toggleLocMenu()" class="flex items-center gap-2 bg-white border border-gray-100 px-3 py-2 rounded-full shadow-sm hover:shadow-md transition-all active:scale-95">
                        <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                        <span id="active-loc-name" class="text-[10px] font-black uppercase tracking-widest text-gray-700">Laugar</span>
                    </button>
                    
                    <div id="loc-dropdown" class="dropdown-menu overflow-hidden p-2">
                        <button onclick="setLocation('LAUGAR')" class="w-full text-left px-4 py-3 text-[10px] font-black uppercase tracking-widest hover:bg-gray-50 rounded-xl transition-colors">Laugar (Allt)</button>
                        <button onclick="setLocation('VATNSMYRI')" class="w-full text-left px-4 py-3 text-[10px] font-black uppercase tracking-widest hover:bg-gray-50 rounded-xl transition-colors border-t border-gray-50">Vatnsmýri</button>
                        <button onclick="setLocation('SELTJARNARNES')" class="w-full text-left px-4 py-3 text-[10px] font-black uppercase tracking-widest hover:bg-gray-50 rounded-xl transition-colors border-t border-gray-50">Seltjarnarnes</button>
                    </div>
                </div>

                <!-- Language Toggle -->
                <button onclick="toggleLanguage()" class="focus:outline-none group">
                    <div id="lang-flag-container" class="w-8 h-8 rounded-full overflow-hidden border-2 border-white shadow-md transition-all group-hover:scale-110 group-hover:shadow-lg">
                        <img id="lang-flag-img" src="https://flagcdn.com/w80/is.png" class="w-full h-full object-cover" alt="Flag">
                    </div>
                </button>
            </div>
            
            <div class="logo-animated mb-6"></div>
            <p id="tagline" class="text-gray-400 font-bold text-[10px] text-center tracking-[0.2em] uppercase"></p>
        </header>

        <!-- Sýnar-val & Leit -->
        <div class="flex flex-col items-center gap-6 mb-12 relative z-30">
            <div class="bg-gray-100/90 p-1 rounded-2xl flex gap-1 border border-gray-200/40 w-full max-w-[280px] relative shadow-inner">
                <button onclick="setViewMode('categories')" id="mode-categories" class="view-toggle-btn flex-1 py-2.5 rounded-xl text-[10px] transition-all uppercase font-black tracking-widest z-10">Flokkar</button>
                <button onclick="setViewMode('themes')" id="mode-themes" class="view-toggle-btn flex-1 py-2.5 rounded-xl text-[10px] transition-all uppercase font-black tracking-widest z-10">Markmið</button>
            </div>

            <div class="search-container flex items-center bg-white border border-gray-100 rounded-full px-6 py-3 w-full max-w-[400px] shadow-sm overflow-hidden">
                <svg class="w-4 h-4 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" id="menu-search" oninput="handleSearch(this.value)" placeholder="Leita á matseðli..." class="w-full bg-transparent outline-none text-sm font-semibold text-gray-800 placeholder-gray-300">
            </div>
        </div>

        <div id="scroll-anchor" class="h-px w-full -mt-2"></div>

        <div id="category-container" class="sticky top-6 z-50 mb-10 hidden">
            <div class="glass rounded-[2rem] overflow-hidden">
                <div class="scroll-mask-container">
                    <nav id="category-tabs" class="flex overflow-x-auto no-scrollbar gap-0 w-full py-4 px-4 justify-start items-center relative">
                        <div id="nav-indicator"></div>
                    </nav>
                </div>
            </div>
        </div>
        <div id="theme-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-12 hidden"></div>

        <!-- Hero -->
        <div class="mb-10">
            <div id="category-hero" class="rounded-[2.5rem] overflow-hidden shadow-xl relative h-44 sm:h-80 hidden animate-slide-up">
                <img id="hero-img" src="" class="w-full h-full object-cover transition-opacity duration-500" alt="Hero" onerror="this.src='https://images.prismic.io/worldclass/aVxY43NYClf9ozUz_menu_21920.jpg?auto=format,compress'">
                <div id="hero-color-overlay" class="absolute inset-0 transition-all duration-300 pointer-events-none mix-blend-multiply opacity-0 z-10"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex items-end p-8 sm:p-12 z-20">
                    <h2 id="hero-title" class="text-white text-3xl sm:text-6xl font-black uppercase tracking-tighter"></h2>
                </div>
            </div>
        </div>

        <!-- Röðunarstika -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-4 mb-10 px-2">
            <span id="sort-label" class="text-[9px] font-black uppercase tracking-[0.2em] text-gray-400">Raða eftir:</span>
            <div class="bg-gray-100/50 p-1 rounded-full border border-gray-200/50 flex-1 overflow-hidden">
                <div class="flex gap-2 overflow-x-auto no-scrollbar relative p-1">
                    <div id="sort-indicator"></div>
                    <button onclick="setSort('kcal')" id="sort-kcal" class="sort-btn px-4 py-1.5 rounded-full text-[9px] text-gray-400 uppercase font-bold">Kcal</button>
                    <button onclick="setSort('protein')" id="sort-protein" class="sort-btn px-4 py-1.5 rounded-full text-[9px] text-gray-400 uppercase font-bold">Prótein</button>
                    <button onclick="setSort('carbs')" id="sort-carbs" class="sort-btn px-4 py-1.5 rounded-full text-[9px] text-gray-400 uppercase font-bold">Kolvetni</button>
                    <button onclick="setSort('fat')" id="sort-fat" class="sort-btn px-4 py-1.5 rounded-full text-[9px] text-gray-400 uppercase font-bold">Fita</button>
                    <button onclick="setSort('category')" id="sort-category" class="sort-btn px-4 py-1.5 rounded-full text-[9px] text-gray-400 uppercase font-bold">Flokkar</button>
                </div>
            </div>
        </div>

        <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[400px]"></div>

        <footer class="mt-24 text-center pb-16">
            <p class="text-gray-300 text-[11px] font-bold tracking-[0.3em] uppercase text-center">World Class &copy; 2026</p>
        </footer>
    </div>

    <!-- Modal (Popup) -->
    <div id="item-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4 bg-gray-950/40 backdrop-blur-sm" onclick="closeModal()">
        <div class="bg-white rounded-[3rem] shadow-2xl max-w-md w-full overflow-hidden transform scale-95 opacity-0 transition-all duration-300 relative" id="modal-content" onclick="event.stopPropagation()">
            
            <div class="absolute top-6 right-6 z-50 flex gap-2 export-hide">
                <button id="share-img-btn" onclick="shareAsImage()" aria-label="Share as image" class="bg-gray-50 p-2.5 rounded-full hover:bg-white text-gray-400 hover:text-blue-500 border border-gray-100 transition-all shadow-sm active:scale-90">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                </button>
                <button onclick="closeModal()" aria-label="Close" class="bg-gray-50 p-2.5 rounded-full hover:bg-white text-gray-400 hover:text-red-500 border border-gray-100 transition-all shadow-sm active:scale-90">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div id="export-container" class="p-8 sm:p-10 bg-white" style="border-radius: 3rem;">
                <div class="flex items-start justify-between mb-8">
                    <div class="flex flex-wrap gap-2.5 pr-10">
                        <span id="modal-tag" class="text-[9px] font-black px-2.5 py-1.5 rounded-lg text-white uppercase tracking-widest shadow-sm"></span>
                        <span id="modal-vegan" class="hidden text-[9px] font-black px-2.5 py-1.5 bg-green-500/10 text-green-600 rounded-lg uppercase tracking-widest border border-green-500/20">Vegan</span>
                    </div>
                    <img id="export-logo" src="https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress" class="hidden h-7 w-auto object-contain" alt="World Class+">
                </div>
                
                <h2 id="modal-title" class="text-2xl font-black text-gray-900 leading-tight mb-4 tracking-tighter"></h2>
                <div id="modal-price-container" class="mb-10 export-hide"></div>
                <div id="modal-ingredients-container" class="mb-10">
                    <h4 id="label-ingredients" class="text-[9px] font-black uppercase tracking-[0.25em] text-gray-300 mb-2">Innihaldslýsing</h4>
                    <p id="modal-description" class="text-gray-700 leading-relaxed text-[14px] font-medium"></p>
                </div>

                <div class="space-y-8">
                    <div id="modal-nutrition-section" class="bg-gray-50/50 rounded-[2.5rem] p-8 border border-gray-100/50 hidden">
                        <div class="flex justify-between items-center mb-8">
                            <h4 id="label-nutrition" class="text-[10px] font-black uppercase tracking-[0.25em] text-gray-300">Næringargildi</h4>
                            <div id="modal-sizes" class="flex gap-2 export-hide"></div>
                        </div>
                        <div class="flex items-center justify-between gap-6">
                            <div class="relative w-[55%] flex justify-center items-center">
                                <svg width="140" height="140" viewBox="0 0 150 150" class="transform -rotate-90">
                                    <circle cx="75" cy="75" r="65" stroke="#f3f4f6" stroke-width="14" fill="transparent" />
                                    <circle id="circle-protein" cx="75" cy="75" r="65" stroke="#f87171" stroke-width="14" fill="transparent" stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                    <circle id="circle-carbs" cx="75" cy="75" r="65" stroke="#fdba74" stroke-width="14" fill="transparent" stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                    <circle id="circle-fat" cx="75" cy="75" r="65" stroke="#7dd3fc" stroke-width="14" fill="transparent" stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                    <span id="val-kcal-center" class="text-2xl font-black text-gray-900 leading-none tracking-tighter">0</span>
                                    <span class="text-[8px] font-black uppercase tracking-widest text-gray-400 mt-1.5">kcal</span>
                                </div>
                            </div>
                            <div id="modal-macros" class="w-[45%] flex flex-col gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ALL_LOCS = ['LAUGAR', 'VATNSMYRI', 'SELTJARNARNES'];
        const SAT_ONLY = ['LAUGAR', 'VATNSMYRI', 'SELTJARNARNES'];
        const LAUGAR_ONLY = ['LAUGAR'];

        const IS_LANG = {
            tagline: 'þín orka, þinn árangur.',
            labelIngredients: 'Innihaldslýsing', labelNutrition: 'Næringargildi', labelSortBy: 'Raða eftir:', labelCat: 'Flokkar', labelGoals: 'Markmið',
            sortKcal: 'Kcal', sortProtein: 'Prót', sortCarbs: 'Kolv', sortFat: 'Fita', sortCategory: 'Flokkar',
            searchPlaceholder: 'Leita á matseðli...',
            noResults: 'Engar niðurstöður fundust.',
            kcal: 'Kcal', protein: 'Prótein', fat: 'Fita', carbs: 'Kolvetni', fiber: 'Trefjar',
            S: 'Lítill', M: 'Mið', L: 'Stór'
        };

        const EN_LANG = {
            tagline: 'Your energy, your success.',
            labelIngredients: 'Ingredients', labelNutrition: 'Nutrition Facts', labelSortBy: 'Sort by:', labelCat: 'Categories', labelGoals: 'Goals',
            sortKcal: 'Kcal', sortProtein: 'Prot', sortCarbs: 'Carbs', sortFat: 'Fat', sortCategory: 'Categories',
            searchPlaceholder: 'Search the menu...',
            noResults: 'No items found.',
            kcal: 'Kcal', protein: 'Protein', fat: 'Fat', carbs: 'Carbs', fiber: 'Fiber',
            S: 'Small', M: 'Medium', L: 'Large'
        };

        const THEMES = {
            LIGHT: { key: 'LIGHT', is: 'Light', en: 'Light', color: '#34d399', descIs: 'Næringarríkt án auka hitaeininga', descEn: 'Nutritious & light' },
            BALANCE: { key: 'BALANCE', is: 'Balance', en: 'Balance', color: '#38bdf8', descIs: 'Stuðlar að einbeitingu og jafnvægi', descEn: 'Focus & balance' },
            ENERGY: { key: 'ENERGY', is: 'Energy', en: 'Energy', color: '#fb923c', descIs: 'Gefur þér orkuna som þú þarft', descEn: 'Energy boost' },
            STRENGTH: { key: 'STRENGTH', is: 'Strength', en: 'Strength', color: '#ef4444', descIs: 'Byggir upp og styrkir líkamann', descEn: 'Build & strengthen' }
        };

        const CATEGORIES = {
            'DRYKKIR': { is: 'Drykkir', en: 'Drinks', img: 'https://images.prismic.io/worldclass/aVxY43NYClf9ozUz_menu_21920.jpg?auto=format,compress' },
            'SALAT': { is: 'Salöt', en: 'Salads', img: 'https://images.prismic.io/worldclass/aVxTN3NYClf9ozUA_menu_11920.jpg' },
            'GRAUTUR': { is: 'Grautar', en: 'Porridge', img: 'https://images.prismic.io/worldclass/aVxTOnNYClf9ozUD_menu_41920.jpg' },
            'KRISP': { is: 'Krisp', en: 'Crisp', img: 'https://images.prismic.io/worldclass/aVxTOXNYClf9ozUC_menu_31920.jpg' },
            'SKOT': { is: 'Skot', en: 'Shots', img: 'https://images.prismic.io/worldclass/aXQ3CAIvOtkhB5aW_skot.jpg' },
            'BÖRN': { is: 'Börn', en: 'Kids', img: 'https://images.prismic.io/worldclass/aVxTOHNYClf9ozUB_menu_21920.jpg' },
            'KAFFI': { is: 'Kaffi', en: 'Coffee', img: 'https://kitchenaid.com.au/cdn/shop/articles/Untitled_design_22_a34b9e85-b904-4444-b67b-c0cb895357ea.png?v=1728611009' },
            'GRÍPTU MEÐ': { is: 'Gríptu með', en: 'Grab & Go', img: 'https://images.prismic.io/worldclass/aXQ2UQIvOtkhB5U_gripamed.jpg?auto=format,compress' }
        };

        const rawData = [
            // DRYKKIR
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Massi', nameEn: 'Bulk', descriptionIs: 'Jarðarber, döðlur, hnetusmjör og prótein.', descriptionEn: 'Strawberries, dates, peanut butter, and protein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:636, protein:39, fat:31, carbs:61, fiber:13}, M:{kcal:707, protein:44, fat:35, carbs:68, fiber:14}, L:{kcal:778, protein:48, fat:38, carbs:75, fiber:15} } },
            { locations: SAT_ONLY, category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Orka', nameEn: 'Energy', descriptionIs: 'Banani, haframjöl, haframjólk, möndlusmjör og prótein.', descriptionEn: 'Banana, oatmeal, oat milk, almond butter, and protein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:833, protein:44, fat:38, carbs:86, fiber:16}, M:{kcal:926, protein:48.9, fat:42.5, carbs:95.7, fiber:17.5}, L:{kcal:1018.6, protein:53.8, fat:46.8, carbs:105.3, fiber:19.3} } },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Berjabomba', nameEn: 'Berry Bomb', descriptionIs: 'Hindber, bláber, ólífuolía, kókosmjólk og prótein.', descriptionEn: 'Raspberries, blueberries, olive oil, coconut milk, and protein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:778.5, protein:24.4, fat:67.7, carbs:21.8, fiber:4.8}, M:{kcal:865, protein:27.5, fat:75.2, carbs:24.2, fiber:5.3}, L:{kcal:951, protein:29.8, fat:82.7, carbs:26.6, fiber:5.8} } },
            { locations: SAT_ONLY, category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Kraftur', nameEn: 'Power', descriptionIs: 'Vanillu skyr, banani, jarðarber og prótein.', descriptionEn: 'Vanilla skyr, banner, strawberries, and protein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:308, protein:38, fat:0.9, carbs:37, fiber:3.6}, M:{kcal:333, protein:40, fat:1, carbs:41, fiber:4}, L:{kcal:354, protein:42, fat:1.1, carbs:44, fiber:4.4} } },
            { locations: SAT_ONLY, category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Prótein ískaffi', nameEn: 'Protein Iced Coffee', descriptionIs: 'Tvöfaldur espresso, möndlumjólk, ólífuolía og prótein.', descriptionEn: 'Double espresso, almond milk, olive oil, and protein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:180, protein:28, fat:8.7, carbs:3.6, fiber:0}, M:{kcal:200, protein:30, fat:9.7, carbs:4, fiber:0}, L:{kcal:220, protein:32, fat:10.7, carbs:4.4, fiber:0} } },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Snerpa', nameEn: 'Vigor', descriptionIs: 'Jarðarber, banani, epli og Amino Energy.', descriptionEn: 'Strawberries, banana, apple, and Amino Energy.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:142, protein:1.4, fat:0.5, carbs:43.5, fiber:3.6}, M:{kcal:157, protein:1.6, fat:0.6, carbs:39, fiber:4}, L:{kcal:173, protein:1.8, fat:0.7, carbs:43, fiber:4.4} }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Græn heilsa', nameEn: 'Green Health', descriptionIs: 'Spínat, mangó, epli, sellerí og collagen.', descriptionEn: 'Spinach, mango, apple, celery, and collagen.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:232.2, protein:28.1, fat:1.2, carbs:31.2, fiber:7.3}, M:{kcal:258, protein:31.2, fat:1.3, carbs:34.7, fiber:8.1}, L:{kcal:283.3, protein:34.3, fat:1.4, carbs:38.2, fiber:8.9} } },
            { locations: SAT_ONLY, category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Brennsla', nameEn: 'Metabolism', descriptionIs: 'Epli, mangó, bláber, engifer og prótein.', descriptionEn: 'Apple, mango, blueberries, ginger, and protein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:283.3, protein:23.3, fat:1.7, carbs:43.7, fiber:6.3}, M:{kcal:300, protein:25.9, fat:1.9, carbs:48.6, fiber:7}, L:{kcal:347, protein:28.5, fat:2.1, carbs:53.5, fiber:7.7} } },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Upphitun', nameEn: 'Warm-up', descriptionIs: 'Vanillu skyr, jarðarber, mangó og ananas.', descriptionEn: 'Vanilla skyr, strawberries, mango, and pineapple.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:177.3, protein:11, fat:2.3, carbs:30.5, fiber:2.7}, M:{kcal:197, protein:12.2, fat:2.5, carbs:33.9, fiber:3}, L:{kcal:216.7, protein:13.4, fat:2.8, carbs:37.3, fiber:3.3} } },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Gleði', nameEn: 'Joy', descriptionIs: 'Sítróna, engifer, jarðarber, epli og jarðarberjaprótein.', descriptionEn: 'Lemon, ginger, strawberries, apple, and strawberry protein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:232, protein:24, fat:2, carbs:33, fiber:5}, M:{kcal:257.5, protein:26.5, fat:2, carbs:36.8, fiber:5.7}, L:{kcal:283.2, protein:29.1, fat:2.2, carbs:40.5, fiber:6.3} } },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Líf', nameEn: 'Life', descriptionIs: 'Avókadó, epli, ananas og engifer.', descriptionEn: 'Avocado, apple, pineapple, and ginger.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:365.4, protein:4, fat:17.8, carbs:56.1, fiber:14.5}, M:{kcal:406, protein:4.4, fat:19.8, carbs:62.3, fiber:16.1}, L:{kcal:446.6, protein:4.8, fat:21.8, carbs:68.5, fiber:17.7} }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Endurnýjun', nameEn: 'Renewal', descriptionIs: 'Rauðrófusafi, avókadó, sellerí, epli og sítróna.', descriptionEn: 'Beetroot juice, avocado, celery, apple, and lemon.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:324, protein:6, fat:18, carbs:43, fiber:13}, M:{kcal:360, protein:6.8, fat:20, carbs:48.5, fiber:13.9}, L:{kcal:396.1, protein:7.48, fat:22, carbs:53.35, fiber:15.29} }, isVegan: true },
            
            // SALAT (Laugar Only)
            { locations: LAUGAR_ONLY, category: 'SALAT', theme: 'STRENGTH', nameIs: 'Strength Salat', nameEn: 'Strength Salad', price: '2.190 kr', descriptionIs: 'Kjúklingur, pasta, vínber, döðlur, parmesanostur.', descriptionEn: 'Chicken, pasta, grapes, dates, and parmesan cheese.', macros: { kcal: 905, protein: 57.4, fat: 33, carbs: 97.6, fiber: 13 } },
            { locations: LAUGAR_ONLY, category: 'SALAT', theme: 'ENERGY', nameIs: 'Energy Salat', nameEn: 'Energy Salad', price: '2.190 kr', descriptionIs: 'Pestó pasta, tómatar, spínat, döðlur, kasjúhnetur og fetaostur.', descriptionEn: 'Pesto pasta, tomatoes, spinach, dates, cashews, and feta cheese.', macros: { kcal: 991, protein: 32.2, fat: 49.4, carbs: 102, fiber: 17 } },
            { locations: LAUGAR_ONLY, category: 'SALAT', theme: 'LIGHT', nameIs: 'Light Salat', nameEn: 'Light Salad', price: '1.890 kr', descriptionIs: 'Salat, túnfiskur, egg, rauðlaukur, gúrka og kotasæludressing.', descriptionEn: 'Salad, tuna, egg, red onion, cucumber, and cottage cheese dressing.', macros: { kcal: 452, protein: 48.5, fat: 16.5, carbs: 14.7, fiber: 3.5 } },
            { locations: LAUGAR_ONLY, category: 'SALAT', theme: 'BALANCE', nameIs: 'Balance Salat', nameEn: 'Balance Salad', price: '2.190 kr', descriptionIs: 'Salat, grænmetisbuff, avocado, rauðlaukur, gúrka, tómatar.', descriptionEn: 'Salad, veggie patty, avocado, red onion, cucumber, and tomatoes.', macros: { kcal: 539, protein: 11.4, fat: 37.6, carbs: 42.2, fiber: 9.5 }, isVegan: true },
            
            // GRAUTUR
            { locations: SAT_ONLY, category: 'GRAUTUR', theme: 'STRENGTH', nameIs: 'Strength Grautur', nameEn: 'Strength Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og vanillu prótein.', descriptionEn: 'Almond milk, oats, honey, and vanilla protein.', macros: { kcal: 731, protein: 44, fat: 13.8, carbs: 115, fiber: 15.5 } },
            { locations: SAT_ONLY, category: 'GRAUTUR', theme: 'ENERGY', nameIs: 'Energy Grautur', nameEn: 'Energy Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og Cookies & Cream prótein.', descriptionEn: 'Almond milk, oats, honey, and Cookies & Cream protein.', macros: { kcal: 720, protein: 42.4, fat: 13, carbs: 110, fiber: 12 } },
            { locations: SAT_ONLY, category: 'GRAUTUR', theme: 'LIGHT', nameIs: 'Light Grautur', nameEn: 'Light Porridge', price: '890 kr', descriptionIs: 'Möndlumjólk, hafrar og hunang.', descriptionEn: 'Almond milk, oats, and honey.', macros: { kcal: 524, protein: 15.6, fat: 14.5, carbs: 87, fiber: 12 } },
            { locations: LAUGAR_ONLY, category: 'GRAUTUR', theme: 'BALANCE', nameIs: 'Balance Grautur', nameEn: 'Balance Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og collagen.', descriptionEn: 'Almond milk, oats, honey, and collagen.', macros: { kcal: 680, protein: 42, fat: 8, carbs: 113, fiber: 13 } },

            // KRISP (Laugar Only)
            { locations: LAUGAR_ONLY, category: 'KRISP', theme: 'STRENGTH', nameIs: 'Túnfisk & Egg Krisp', nameEn: 'Tuna & Egg Crisp', price: '1.290 kr', descriptionIs: '4x Finn Crisp og túnfisksalat.', descriptionEn: '4x Finn Crisp and tuna salad.', macros: { kcal: 313, protein: 31.8, fat: 15.5, carbs: 16.9, fiber: 4.6 } },
            { locations: LAUGAR_ONLY, category: 'KRISP', theme: 'ENERGY', nameIs: 'Kjúklinga Avocado Krisp', nameEn: 'Chicken Avocado Crisp', price: '1.290 kr', descriptionIs: '4x Finn Crisp, kjúklingur, avókadó og sesamfræ.', descriptionEn: '4x Finn Crisp, chicken, avocado, and sesame seeds.', macros: { kcal: 290, protein: 22.8, fat: 14.5, carbs: 21.9, fiber: 6.6 } },
            { locations: LAUGAR_ONLY, category: 'KRISP', theme: 'LIGHT', nameIs: 'Kjúklinga Krisp', nameEn: 'Chicken Crisp', price: '1.190 kr', descriptionIs: '4x Finn Crisp, kjúklingasalat og tómatar.', descriptionEn: '4x Finn Crisp, chicken salad, and tomatoes.', macros: { kcal: 288, protein: 28.8, fat: 12.5, carbs: 14.9, fiber: 4.1 } },
            { locations: LAUGAR_ONLY, category: 'KRISP', theme: 'BALANCE', nameIs: 'Hummus Krisp', nameEn: 'Hummus Crisp', price: '1.190 kr', descriptionIs: '4x Finn Crisp, hummus og tómatar.', descriptionEn: '4x Finn Crisp, hummus, and tomatoes.', macros: { kcal: 263, protein: 10.8, fat: 7.5, carbs: 49.9, fiber: 18.6 }, isVegan: true },
            
            // SKOT
            { locations: SAT_ONLY, category: 'SKOT', theme: 'ENERGY', nameIs: 'Orkuskot', nameEn: 'Energy Shot', price: '450 kr', descriptionIs: 'Rauðrófa, túrmerik, engifer, sítróna, epli.', descriptionEn: 'Beetroot, turmeric, ginger, lemon, apple.', macros: { kcal: 22, protein: 0.5, fat: 0, carbs: 5.2, fiber: 0.6 }, isVegan: true },
            { locations: SAT_ONLY, category: 'SKOT', theme: 'STRENGTH', nameIs: 'Kraftskot', nameEn: 'Power Shot', price: '450 kr', descriptionIs: 'Kreatín, epli.', descriptionEn: 'Creatine, apple.', macros: { kcal: 18, protein: 0.2, fat: 0, carbs: 4.5, fiber: 0.4 }, isVegan: true },
            { locations: SAT_ONLY, category: 'SKOT', theme: 'LIGHT', nameIs: 'Ofurskot', nameEn: 'Super Shot', price: '450 kr', descriptionIs: 'Túrmerik, engifer, sítróna, epli, kanill.', descriptionEn: 'Turmeric, ginger, lemon, apple, cinnamon.', macros: { kcal: 20, protein: 0.4, fat: 0, carbs: 4.8, fiber: 0.5 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'SKOT', theme: 'BALANCE', nameIs: 'Spirúlína', nameEn: 'Spirulina', price: '350 kr', descriptionIs: 'Hágæða spirúlína skot.', descriptionEn: 'High quality spirulina shot.', macros: { kcal: 15, protein: 2.1, fat: 0.4, carbs: 0.9, fiber: 0.2 }, isVegan: true },
            { locations: SAT_ONLY, category: 'SKOT', theme: 'BALANCE', nameIs: 'Engifer', nameEn: 'Ginger', price: '350 kr', descriptionIs: 'Hreint engifer skot.', descriptionEn: 'Pure ginger shot.', macros: { kcal: 12, protein: 0.3, fat: 0, carbs: 2.5, fiber: 0.3 }, isVegan: true },
            { locations: SAT_ONLY, category: 'SKOT', theme: 'BALANCE', nameIs: 'Túrmerik', nameEn: 'Turmeric', price: '350 kr', descriptionIs: 'Hreint túrmerik skot.', descriptionEn: 'Pure turmeric shot.', macros: { kcal: 14, protein: 0.3, fat: 0, carbs: 2.8, fiber: 0.3 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'SKOT', theme: 'BALANCE', nameIs: 'Rauðrófa', nameEn: 'Beetroot', price: '350 kr', descriptionIs: 'Hreinn rauðrófusafi.', descriptionEn: 'Pure beetroot juice.', macros: { kcal: 19, protein: 0.6, fat: 0, carbs: 4.1, fiber: 0.5 }, isVegan: true },

            // BÖRN (Laugar Only)
            { locations: LAUGAR_ONLY, category: 'BÖRN', theme: 'ALL', nameIs: 'Jarðarberjaboost', nameEn: 'Strawberry Boost', price: '890 kr', descriptionIs: 'Jarðarber, banani, epli.', descriptionEn: 'Strawberries, banner, apple.', macros: { kcal: 180, protein: 2.2, fat: 0.8, carbs: 42, fiber: 3.8 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'BÖRN', theme: 'ALL', nameIs: 'Bláberjaboost', nameEn: 'Blueberry Boost', price: '890 kr', descriptionIs: 'Bláber, banani, epli.', descriptionEn: 'Blueberries, banner, apple.', macros: { kcal: 175, protein: 2, fat: 0.7, carbs: 40, fiber: 4.2 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'BÖRN', theme: 'ALL', nameIs: 'Fruit minis', nameEn: 'Fruit minis', price: '190 kr', descriptionIs: 'Hindberja & bláberja.', descriptionEn: 'Raspberry & blueberry.', macros: { kcal: 45, protein: 0.5, fat: 0.1, carbs: 10, fiber: 1.5 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'BÖRN', theme: 'ALL', nameIs: 'BEAR ávaxtarúlla', nameEn: 'BEAR Fruit Roll-up', price: '190 kr', descriptionIs: 'Jarðarberja.', descriptionEn: 'Strawberry.', macros: { kcal: 50, protein: 0.4, fat: 0.1, carbs: 11, fiber: 1.2 }, isVegan: true },

            // KAFFI
            { locations: SAT_ONLY, category: 'KAFFI', theme: 'ALL', nameIs: 'Espresso', nameEn: 'Espresso', price: '500 kr', descriptionIs: 'Einfaldur og sterkur espresso.', descriptionEn: 'Single shot of strong espresso.', macros: { kcal: 2, protein: 0.1, fat: 0, carbs: 0.4, fiber: 0 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'KAFFI', theme: 'ALL', nameIs: 'Americano', nameEn: 'Americano', price: '500 kr', descriptionIs: 'Klassískt svart kaffi.', descriptionEn: 'Classic black coffee.', macros: { kcal: 5, protein: 0.2, fat: 0, carbs: 1, fiber: 0 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'KAFFI', theme: 'ALL', nameIs: 'Tvöfaldur Espresso', nameEn: 'Double Espresso', price: '500 kr', descriptionIs: 'Tvöfaldur skammtur af espresso.', descriptionEn: 'Double shot of espresso.', macros: { kcal: 4, protein: 0.2, fat: 0, carbs: 0.8, fiber: 0 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'KAFFI', theme: 'ALL', nameIs: 'Cappuccino', nameEn: 'Cappuccino', price: '500 kr', descriptionIs: 'Espresso með flóaðri jurtamjólk.', descriptionEn: 'Espresso with steamed plant-based milk.', macros: { kcal: 92, protein: 3.4, fat: 4.2, carbs: 9.5, fiber: 0.8 } },
            { locations: LAUGAR_ONLY, category: 'KAFFI', theme: 'ALL', nameIs: 'Latte', nameEn: 'Latte', price: '500 kr', descriptionIs: 'Tvöfaldur espresso með mjúkri jurtamjólk.', descriptionEn: 'Double espresso with silky plant-based milk.', macros: { kcal: 120, protein: 4.2, fat: 6.4, carbs: 12, fiber: 1.2 } },
            
            // GRÍPTU MEÐ (Laugar Only)
            { locations: LAUGAR_ONLY, category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Harðfiskur', nameEn: 'Dried Fish', price: '990 kr', descriptionIs: 'Hágæða íslenskur harðfiskur.', descriptionEn: 'High quality Icelandic dried fish.', macros: { kcal: 320, protein: 78, fat: 1, carbs: 0, fiber: 0 } },
            { locations: LAUGAR_ONLY, category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Prótein muffins', nameEn: 'Protein Muffin', price: '590 kr', descriptionIs: 'Próteinrík muffins-kaka.', descriptionEn: 'Protein-rich muffin.', macros: { kcal: 240, protein: 18, fat: 8, carbs: 22, fiber: 4 } },
            { locations: LAUGAR_ONLY, category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Hnetumix', nameEn: 'Nut Mix', price: '390 kr', descriptionIs: 'Blanda af völdum hnetum.', descriptionEn: 'Selection of mixed nuts.', macros: { kcal: 180, protein: 8, fat: 14, carbs: 12, fiber: 3 }, isVegan: true },
            { locations: LAUGAR_ONLY, category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Egg', nameEn: 'Egg', price: '250 kr', descriptionIs: 'Eitt soðið egg.', descriptionEn: 'One boiled egg.', macros: { kcal: 78, protein: 6, fat: 5, carbs: 1, fiber: 0 } },
            { locations: LAUGAR_ONLY, category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Epli', nameEn: 'Apple', price: '150 kr', descriptionIs: 'Ferskt epli.', descriptionEn: 'Fresh apple.', isVegan: true },
            { locations: LAUGAR_ONLY, category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Banani', nameEn: 'Banana', price: '170 kr', descriptionIs: 'Ferskur banani.', descriptionEn: 'Fresh banana.', isVegan: true }
        ];

        let state = { 
            isIcelandic: true, 
            viewMode: 'categories', 
            activeCategory: 'DRYKKIR', 
            activeTheme: null, 
            activeLocation: 'LAUGAR',
            selectedSize: 'M', 
            sortBy: 'category',
            searchQuery: '',
            modalItem: null
        };
        
        const getLang = () => state.isIcelandic ? IS_LANG : EN_LANG;

        function toggleLocMenu() { document.getElementById('loc-dropdown').classList.toggle('active'); }
        window.onclick = function(e) { if (!e.target.closest('.relative')) document.getElementById('loc-dropdown').classList.remove('active'); }

        function setLocation(loc) {
            state.activeLocation = loc;
            document.getElementById('active-loc-name').textContent = loc === 'LAUGAR' ? 'Laugar' : loc === 'VATNSMYRI' ? 'Vatnsmýri' : 'Seltjarnarnes';
            document.getElementById('loc-dropdown').classList.remove('active');
            
            const availableCategories = getAvailableCategories();
            if (!availableCategories.includes(state.activeCategory)) {
                state.activeCategory = availableCategories[0] || null;
            }
            
            render();
        }

        function toggleLanguage() {
            state.isIcelandic = !state.isIcelandic;
            updateFlagAndLabel();
            render();
        }

        function updateFlagAndLabel() {
            document.getElementById('lang-flag-img').src = state.isIcelandic ? "https://flagcdn.com/w80/is.png" : "https://flagcdn.com/w80/gb.png";
            document.getElementById('menu-search').placeholder = getLang().searchPlaceholder;
        }

        function handleSearch(val) { state.searchQuery = val.toLowerCase().trim(); renderGrid(); }

        function setViewMode(mode) {
            state.viewMode = mode;
            if (mode === 'categories') { 
                state.activeTheme = null; 
                state.activeCategory = getAvailableCategories()[0] || 'DRYKKIR'; 
            } 
            else { state.activeCategory = null; state.activeTheme = 'LIGHT'; }
            render();
            const anchor = document.getElementById('scroll-anchor');
            if (anchor) window.scrollTo({ top: anchor.offsetTop - 24, behavior: 'smooth' });
        }

        function setSort(type) { state.sortBy = type; render(); }

        function getAvailableCategories() {
            const categoriesAtLoc = new Set();
            rawData.forEach(item => {
                if (item.locations.includes(state.activeLocation)) {
                    categoriesAtLoc.add(item.category);
                }
            });
            return Object.keys(CATEGORIES).filter(key => categoriesAtLoc.has(key));
        }

        function updateSwoosh() {
            const activeTab = document.querySelector('.active-tab');
            const indicator = document.getElementById('nav-indicator');
            if (activeTab && indicator) {
                indicator.style.width = activeTab.offsetWidth + 'px';
                indicator.style.left = activeTab.offsetLeft + 'px';
                indicator.style.opacity = "1";
            } else if (indicator) {
                indicator.style.opacity = "0";
            }
        }

        function render() {
            const lang = getLang();
            document.getElementById('tagline').textContent = lang.tagline;
            document.getElementById('sort-label').textContent = lang.labelSortBy;
            document.getElementById('mode-categories').textContent = lang.labelCat;
            document.getElementById('mode-themes').textContent = lang.labelGoals;
            
            document.querySelectorAll('.view-toggle-btn').forEach(btn => {
                const active = btn.id === 'mode-' + state.viewMode;
                btn.classList.toggle('bg-white', active); btn.classList.toggle('text-gray-900', active);
                btn.classList.toggle('text-gray-400', !active);
            });

            document.getElementById('category-container').classList.toggle('hidden', state.viewMode !== 'categories');
            document.getElementById('theme-container').classList.toggle('hidden', state.viewMode !== 'themes');
            renderNav(); renderThemeButtons(); renderHero(); renderGrid();
            setTimeout(updateSwoosh, 10);
        }

        function renderNav() {
            const container = document.getElementById('category-tabs');
            container.innerHTML = '<div id="nav-indicator"></div>';
            const availableCategories = getAvailableCategories();
            availableCategories.forEach(key => {
                const info = CATEGORIES[key];
                const active = state.activeCategory === key;
                const btn = document.createElement('button');
                btn.onclick = () => { state.activeCategory = key; render(); };
                btn.className = `category-tab flex-1 text-center transition-all ${active ? 'active-tab text-white' : 'text-gray-400'}`;
                btn.textContent = state.isIcelandic ? info.is : info.en;
                container.appendChild(btn);
            });
        }

        function renderThemeButtons() {
            const container = document.getElementById('theme-container');
            container.innerHTML = ['LIGHT', 'BALANCE', 'ENERGY', 'STRENGTH'].map(key => {
                const t = THEMES[key]; const active = state.activeTheme === t.key;
                return `<button onclick="state.activeTheme='${t.key}';render()" class="p-4 rounded-3xl flex items-start gap-3 bg-white border border-gray-100 transition-all ${active ? 'ring-2 ring-red-500 shadow-lg' : ''}" style="color:${t.color}"><div class="w-2.5 h-2.5 rounded-full mt-1 flex-shrink-0" style="background-color:${t.color}"></div><div><h5 class="text-[10px] font-black uppercase tracking-widest mb-1 text-gray-900">${state.isIcelandic ? t.is : t.en}</h5><p class="text-[9px] text-gray-400 leading-tight">${state.isIcelandic ? t.descIs : t.descEn}</p></div></button>`;
            }).join('');
        }

        function renderHero() {
            const hero = document.getElementById('category-hero');
            const heroImg = document.getElementById('hero-img');
            const heroTitle = document.getElementById('hero-title');
            const overlay = document.getElementById('hero-color-overlay');
            let src="", title="", color="", op="0";
            if (state.viewMode==='themes' && state.activeTheme) {
                const t = THEMES[state.activeTheme]; src="https://images.prismic.io/worldclass/aVxTO3NYClf9ozUE_menu1920.jpg"; title=state.isIcelandic?t.is:t.en; color=t.color; op="0.5";
            } else if (state.viewMode==='categories' && state.activeCategory) {
                const c = CATEGORIES[state.activeCategory]; src=c.img; title=state.isIcelandic?c.is:c.en;
            }
            if (src && !state.searchQuery) { hero.classList.remove('hidden'); heroImg.src=src; heroTitle.textContent=title; overlay.style.backgroundColor=color; overlay.style.opacity=op; }
            else hero.classList.add('hidden');
        }

        function renderGrid() {
            const container = document.getElementById('menu-grid');
            const lang = getLang();
            let items = rawData.filter(i => i.locations.includes(state.activeLocation));
            
            if (state.searchQuery) items = items.filter(i => i.nameIs.toLowerCase().includes(state.searchQuery) || i.nameEn.toLowerCase().includes(state.searchQuery));
            else if (state.viewMode==='themes' && state.activeTheme) items = items.filter(i => i.theme === state.activeTheme || i.theme === 'ALL');
            else if (state.viewMode==='categories' && state.activeCategory) items = items.filter(i => i.category === state.activeCategory);

            container.innerHTML = items.map(item => {
                const theme = THEMES[item.theme] || { color:'#9ca3af' };
                const price = item.prices ? item.prices.M : item.price;
                const m = item.macros ? (item.prices ? item.macros.M : item.macros) : null;
                return `<div class="item-card bg-white p-7 rounded-[2.2rem] border border-gray-50 shadow-sm cursor-pointer" onclick="openModal(${rawData.indexOf(item)})">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-[8px] font-black px-2 py-0.5 rounded-md text-white uppercase tracking-widest" style="background-color:${theme.color}">${state.isIcelandic ? (THEMES[item.theme]?.is || '') : (THEMES[item.theme]?.en || '')}</span>
                        <span class="text-base font-black text-red-500 tracking-tight block leading-none">${price || ''}</span>
                    </div>
                    <h3 class="text-lg font-black text-gray-900 mb-2 tracking-tight leading-tight">${state.isIcelandic?item.nameIs:item.nameEn}</h3>
                    <p class="text-gray-400 text-xs leading-relaxed line-clamp-2 mb-4">${state.isIcelandic?item.descriptionIs:item.descriptionEn}</p>
                    ${m ? `<div class="card-macro-grid grid grid-cols-4 gap-2">
                        <div class="flex flex-col"><span class="text-[7px] uppercase font-black text-gray-300">${lang.kcal}</span><span class="text-[11px] font-black">${Math.round(m.kcal)}</span></div>
                        <div class="flex flex-col"><span class="text-[7px] uppercase font-black text-red-400">${lang.sortProtein}</span><span class="text-[11px] font-black">${Math.round(m.protein)}g</span></div>
                        <div class="flex flex-col"><span class="text-[7px] uppercase font-black text-orange-400">${lang.sortCarbs}</span><span class="text-[11px] font-black">${Math.round(m.carbs)}g</span></div>
                        <div class="flex flex-col"><span class="text-[7px] uppercase font-black text-blue-400">${lang.sortFat}</span><span class="text-[11px] font-black">${Math.round(m.fat)}g</span></div>
                    </div>` : ''}
                </div>`;
            }).join('');
            container.querySelectorAll('.item-card').forEach((c, i) => setTimeout(() => c.classList.add('visible'), i*80));
        }

        function openModal(idx) {
            const item = rawData[idx]; state.modalItem = item; state.selectedSize = item.prices ? 'M' : null;
            document.getElementById('modal-title').textContent = state.isIcelandic?item.nameIs:item.nameEn;
            document.getElementById('modal-description').textContent = state.isIcelandic?item.descriptionIs:item.descriptionEn;
            document.getElementById('modal-tag').textContent = state.isIcelandic?THEMES[item.theme]?.is:THEMES[item.theme]?.en;
            document.getElementById('modal-tag').style.backgroundColor = THEMES[item.theme]?.color;
            updateModalUI();
            const modal = document.getElementById('item-modal');
            modal.classList.replace('hidden', 'flex');
            setTimeout(() => { document.getElementById('modal-content').classList.replace('opacity-0', 'opacity-100'); document.getElementById('modal-content').classList.replace('scale-95', 'scale-100'); }, 50);
        }

        function updateModalUI() {
            const item = state.modalItem; const lang = getLang();
            const pCont = document.getElementById('modal-price-container');
            if (item.prices) pCont.innerHTML = `<div class="grid grid-cols-3 gap-2">${Object.keys(item.prices).map(s => `<button onclick="state.selectedSize='${s}';updateModalUI()" class="flex flex-col items-center py-2.5 rounded-2xl border ${state.selectedSize===s?'border-red-400 bg-red-50 text-red-500 font-black':'border-gray-100'}"><span class="text-[9px] uppercase font-black">${lang[s]}</span><span class="text-sm font-bold">${item.prices[s]}</span></button>`).join('')}</div>`;
            else pCont.innerHTML = `<span class="text-3xl font-black text-red-500 tracking-tighter">${item.price || ''}</span>`;
            
            const m = item.macros ? (item.prices ? item.macros[state.selectedSize] : item.macros) : null;
            if (m) {
                document.getElementById('modal-nutrition-section').classList.remove('hidden');
                document.getElementById('val-kcal-center').textContent = Math.round(m.kcal);
                document.getElementById('modal-macros').innerHTML = ['protein','carbs','fat'].map(k => `<div class="bg-gray-50 px-5 py-2.5 rounded-[1.4rem] flex items-center justify-between"><span class="text-[6.5px] font-black uppercase tracking-[0.2em] text-gray-500">${lang[k]}</span><span class="text-sm font-black text-gray-800">${Math.round(m[k])}g</span></div>`).join('');
            } else document.getElementById('modal-nutrition-section').classList.add('hidden');
        }

        function closeModal() { 
            document.getElementById('modal-content').classList.replace('opacity-100', 'opacity-0');
            document.getElementById('modal-content').classList.replace('scale-100', 'scale-95');
            setTimeout(() => document.getElementById('item-modal').classList.replace('flex', 'hidden'), 300);
        }

        window.onload = function() {
            const p = new URLSearchParams(window.location.search);
            if (p.get('lang')==='en') state.isIcelandic=false;
            if (p.get('loc')) setLocation(p.get('loc').toUpperCase());
            updateFlagAndLabel(); render();
        };
    </script>
</body>
</html>
