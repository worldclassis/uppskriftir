<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Class+ Menu</title>
    
    <!-- Meta tags for Social Media Sharing -->
    <meta property="og:title" content="World Class+ Menu">
    <meta property="og:description" content="Gagnvirkur matseðill Laugar Cafe - Þín orka, þinn árangur.">
    <meta property="og:image" content="https://images.prismic.io/worldclass/aVxY43NYClf9ozUz_menu_21920.jpg?auto=format,compress">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #ef4444; 
            --secondary: #111827;
            --background: #fafafa;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--secondary);
            -webkit-tap-highlight-color: transparent;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 40px -15px rgba(0, 0, 0, 0.05);
        }
        
        .scroll-mask-container {
            position: relative;
            mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
        }

        .item-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.05);
        }

        .category-tab {
            transition: all 0.3s ease;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-weight: 800;
            font-size: 0.6rem;
            padding: 0.5rem 1.2rem;
        }

        .active-tab {
            background-color: var(--primary);
            color: white !important;
            border-radius: 9999px;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.2);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes nudge {
            0% { transform: translateX(0); }
            30% { transform: translateX(-15px); }
            60% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
        .nudge-effect {
            animation: nudge 0.8s ease-in-out;
        }

        .logo-animated {
            width: 220px;
            height: 48px;
            background: linear-gradient(
                45deg, 
                #ef4444, #ef4444, #ef4444, 
                #facc15, #38bdf8, #ef4444
            );
            background-size: 300% 300%;
            -webkit-mask: url("https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress") no-repeat center;
            mask: url("https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            animation: logoGradientFlow 8s ease infinite;
        }

        @keyframes logoGradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .macro-circle {
            transform-origin: center;
        }
    </style>
</head>
<body class="antialiased selection:bg-red-100 selection:text-red-600">

    <div class="max-w-4xl mx-auto px-4 pt-6 pb-8 sm:pt-12">
        
        <!-- Haus -->
        <header class="flex flex-col items-center mb-16 sm:mb-24">
            <div class="w-full flex justify-end items-center mb-10">
                <button onclick="toggleLanguage()" class="focus:outline-none">
                    <div id="lang-flag-container" class="w-7 h-7 rounded-full overflow-hidden border-2 border-white shadow-md transition-transform hover:scale-110">
                        <img id="lang-flag-img" src="https://flagcdn.com/w80/is.png" class="w-full h-full object-cover" alt="Flag">
                    </div>
                </button>
            </div>
            
            <div class="logo-animated mb-6"></div>
            <p id="tagline" class="text-gray-400 font-bold text-[10px] text-center tracking-[0.2em] uppercase"></p>
        </header>

        <!-- Sýnar-val -->
        <div class="flex justify-center mb-12">
            <div class="bg-gray-100/80 p-1 rounded-2xl flex gap-1 border border-gray-200/50">
                <button onclick="setViewMode('categories')" id="mode-categories" class="view-toggle-btn px-8 py-2 rounded-xl text-[10px] text-gray-400 transition-all uppercase font-black tracking-widest">Flokkar</button>
                <button onclick="setViewMode('themes')" id="mode-themes" class="view-toggle-btn px-8 py-2 rounded-xl text-[10px] text-gray-400 transition-all uppercase font-black tracking-widest">Markmið</button>
            </div>
        </div>

        <div id="scroll-anchor" class="h-px w-full -mt-24 mb-24"></div>

        <!-- Síustikur -->
        <div id="category-container" class="sticky top-6 z-40 mb-10 hidden">
            <div class="glass rounded-[2rem] overflow-hidden">
                <div class="scroll-mask-container">
                    <nav id="category-tabs" class="flex overflow-x-auto no-scrollbar gap-1 w-full py-4 px-6 justify-start items-center"></nav>
                </div>
            </div>
        </div>
        <div id="theme-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-12 hidden"></div>

        <!-- Hero -->
        <div class="mb-10">
            <div id="category-hero" class="rounded-[2.5rem] overflow-hidden shadow-xl relative h-40 sm:h-72 hidden animate-slide-up">
                <img id="hero-img" src="" class="w-full h-full object-cover" alt="Hero">
                <div id="hero-color-overlay" class="absolute inset-0 transition-all duration-300 pointer-events-none mix-blend-multiply opacity-0 z-10"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex items-end p-8 z-20">
                    <h2 id="hero-title" class="text-white text-3xl sm:text-6xl font-black uppercase tracking-tighter"></h2>
                </div>
            </div>
        </div>

        <!-- Röðunarstika -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-4 mb-10 px-2">
            <span id="sort-label" class="text-[9px] font-black uppercase tracking-[0.2em] text-gray-400">Raða eftir:</span>
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button onclick="setSort('kcal')" id="sort-kcal" class="sort-btn px-4 py-1.5 rounded-full text-[9px] border border-gray-200 bg-white text-gray-500 uppercase font-bold">Kcal</button>
                <button onclick="setSort('protein')" id="sort-protein" class="sort-btn px-4 py-1.5 rounded-full text-[9px] border border-gray-200 bg-white text-gray-500 uppercase font-bold">Prótein</button>
                <button onclick="setSort('carbs')" id="sort-carbs" class="sort-btn px-4 py-1.5 rounded-full text-[9px] border border-gray-200 bg-white text-gray-500 uppercase font-bold">Kolvetni</button>
                <button onclick="setSort('fat')" id="sort-fat" class="sort-btn px-4 py-1.5 rounded-full text-[9px] border border-gray-200 bg-white text-gray-500 uppercase font-bold">Fita</button>
                <button onclick="setSort('category')" id="sort-category" class="sort-btn px-4 py-1.5 rounded-full text-[9px] border border-gray-200 bg-white text-gray-500 uppercase font-bold">Flokkar</button>
            </div>
        </div>

        <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[400px]"></div>

        <section class="mt-24 relative rounded-[2.5rem] overflow-hidden shadow-xl">
            <img src="https://images.prismic.io/worldclass/aWEQsgIvOtkhBOhn_WC%2B_Salatbar2.jpg?" alt="Auglýsing" class="w-full h-auto object-cover">
        </section>
        
        <footer class="mt-24 text-center pb-16">
            <p class="text-gray-300 text-[9px] font-bold tracking-[0.3em] uppercase text-center">World Class &copy; 2026</p>
        </footer>
    </div>

    <!-- Modal (Popup) -->
    <div id="item-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4 bg-gray-950/25 backdrop-blur-sm transition-opacity duration-300" onclick="closeModal()">
        <div class="bg-white rounded-[3rem] shadow-2xl max-w-sm w-full overflow-hidden transform scale-95 opacity-0 transition-all duration-300 relative" id="modal-content" onclick="event.stopPropagation()">
            
            <div class="absolute top-6 right-6 z-50 flex gap-2 export-hide">
                <button id="share-img-btn" onclick="shareAsImage()" class="bg-gray-50 p-2 rounded-full hover:bg-white text-gray-400 hover:text-blue-500 border border-gray-100 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                </button>
                <button onclick="closeModal()" class="bg-gray-50 p-2 rounded-full hover:bg-white text-gray-400 hover:text-red-500 border border-gray-100 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div id="export-container" class="p-8 bg-white" style="border-radius: 3rem;">
                <div class="flex items-start justify-between mb-6">
                    <div class="flex flex-wrap gap-2 pr-10">
                        <span id="modal-tag" class="text-[8px] font-black px-2 py-1 rounded-md text-white uppercase tracking-widest shadow-sm"></span>
                        <span id="modal-vegan" class="hidden text-[8px] font-black px-2 py-1 bg-green-500/10 text-green-600 rounded-md uppercase tracking-widest border border-green-500/20">Vegan</span>
                    </div>
                    <img id="export-logo" src="https://images.prismic.io/worldclass/aVxQ23NYClf9ozTn_WorldClass%2B_Logo_black.png?auto=format,compress" class="hidden h-6 w-auto object-contain" alt="World Class+">
                </div>
                
                <h2 id="modal-title" class="text-2xl font-black text-gray-900 leading-tight mb-4 tracking-tight"></h2>
                <div id="modal-price-container" class="mb-8 export-hide"></div>

                <div class="mb-8">
                    <h4 id="label-ingredients" class="text-[8px] font-black uppercase tracking-[0.25em] text-gray-300 mb-2">Innihaldslýsing</h4>
                    <p id="modal-description" class="text-gray-700 leading-relaxed text-[13px] font-medium"></p>
                </div>

                <div class="space-y-6">
                    <div id="modal-nutrition-section" class="bg-gray-50/50 rounded-[2.5rem] p-6 border border-gray-100/50 hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h4 id="label-nutrition" class="text-[8px] font-black uppercase tracking-[0.25em] text-gray-300">Næringargildi</h4>
                            <div id="modal-sizes" class="flex gap-2 export-hide"></div>
                        </div>
                        
                        <div class="flex items-center justify-between gap-6">
                            <div class="relative flex-shrink-0">
                                <svg width="100" height="100" viewBox="0 0 150 150" class="transform -rotate-90">
                                    <circle cx="75" cy="75" r="65" stroke="#f3f4f6" stroke-width="14" fill="transparent" />
                                    <circle id="circle-protein" cx="75" cy="75" r="65" stroke="#f87171" stroke-width="14" fill="transparent" stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                    <circle id="circle-carbs" cx="75" cy="75" r="65" stroke="#fdba74" stroke-width="14" fill="transparent" stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                    <circle id="circle-fat" cx="75" cy="75" r="65" stroke="#7dd3fc" stroke-width="14" fill="transparent" stroke-dasharray="408.4" stroke-dashoffset="408.4" stroke-linecap="butt" class="macro-circle" />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                    <span id="val-kcal-center" class="text-xl font-black text-gray-900 leading-none">0</span>
                                    <span class="text-[7px] font-black uppercase tracking-widest text-gray-400 mt-1">kcal</span>
                                </div>
                            </div>
                            <div id="modal-macros" class="flex-grow flex flex-col gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const IS_LANG = {
            tagline: 'þín orka, þinn árangur.',
            labelIngredients: 'Innihaldslýsing', labelNutrition: 'Næringargildi', labelSortBy: 'Raða eftir:', labelCat: 'Flokkar', labelGoals: 'Markmið',
            sortKcal: 'Kcal', sortProtein: 'Prótein', sortCarbs: 'Kolvetni', sortFat: 'Fita', sortCategory: 'Flokkar',
            noResults: 'Engar niðurstöður fundust.',
            kcal: 'Kcal', protein: 'Prótein', fat: 'Fita', carbs: 'Kolvetni', fiber: 'Trefjar',
            S: 'Lítill', M: 'Mið', L: 'Stór'
        };

        const EN_LANG = {
            tagline: 'Your energy, your success.',
            labelIngredients: 'Ingredients', labelNutrition: 'Nutrition Facts', labelSortBy: 'Sort by:', labelCat: 'Categories', labelGoals: 'Goals',
            sortKcal: 'Kcal', sortProtein: 'Protein', sortCarbs: 'Carbs', sortFat: 'Fat', sortCategory: 'Categories',
            noResults: 'No items found.',
            kcal: 'Kcal', protein: 'Protein', fat: 'Fat', carbs: 'Carbs', fiber: 'Fiber',
            S: 'Small', M: 'Medium', L: 'Large'
        };

        const THEMES = {
            LIGHT: { key: 'LIGHT', is: 'Light', en: 'Light', color: '#34d399', descIs: 'Næringarríkt án auka hitaeininga', descEn: 'Nutritious & light' },
            BALANCE: { key: 'BALANCE', is: 'Balance', en: 'Balance', color: '#38bdf8', descIs: 'Stuðlar að einbeitingu og jafnvægi', descEn: 'Focus & balance' },
            ENERGY: { key: 'ENERGY', is: 'Energy', en: 'Energy', color: '#fb923c', descIs: 'Gefur þér orkuna som þú þarft', descEn: 'Energy boost' },
            STRENGTH: { key: 'STRENGTH', is: 'Strength', en: 'Strength', color: '#ef4444', descIs: 'Byggir upp og styrkir líkamann', descEn: 'Build & strengthen' }
        };

        const CATEGORIES = {
            'DRYKKIR': { is: 'Drykkir', en: 'Drinks', img: 'https://images.prismic.io/worldclass/aVxY43NYClf9ozUz_menu_21920.jpg?auto=format,compress' },
            'SALAT': { is: 'Salöt', en: 'Salads', img: 'https://images.prismic.io/worldclass/aVxTN3NYClf9ozUA_menu_11920.jpg' },
            'GRAUTUR': { is: 'Grautar', en: 'Porridge', img: 'https://images.prismic.io/worldclass/aVxTOnNYClf9ozUD_menu_41920.jpg' },
            'KRISP': { is: 'Krisp', en: 'Crisp', img: 'https://images.prismic.io/worldclass/aVxTOXNYClf9ozUC_menu_31920.jpg' },
            'SKOT': { is: 'Skot', en: 'Shots', img: 'https://images.prismic.io/worldclass/aXQ3CAIvOtkhB5aW_skot.jpg' },
            'BÖRN': { is: 'Börn', en: 'Kids', img: 'https://images.prismic.io/worldclass/aVxTOHNYClf9ozUB_menu_21920.jpg' },
            'KAFFI': { is: 'Kaffi', en: 'Coffee', img: 'https://kitchenaid.com.au/cdn/shop/articles/Untitled_design_22_a34b9e85-b904-4444-b67b-c0cb895357ea.png?v=1728611009' },
            'GRÍPTU MEÐ': { is: 'Gríptu með', en: 'Grab & Go', img: 'https://images.prismic.io/worldclass/aXQ2UQIvOtkhB5aU_gripamed.jpg?auto=format,compress' }
        };

        const rawData = [
            { category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Massi', nameEn: 'Bulk', descriptionIs: 'Jarðarber, döðlur, hnetusmjör og prótein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:636, protein:39, fat:31, carbs:61, fiber:13}, M:{kcal:707, protein:44, fat:35, carbs:68, fiber:14}, L:{kcal:778, protein:48, fat:38, carbs:75, fiber:15} } },
            { category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Orka', nameEn: 'Energy', descriptionIs: 'Banani, haframjöl, haframjólk, möndlusmjör og prótein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:833, protein:44, fat:38, carbs:86, fiber:16}, M:{kcal:926, protein:49, fat:43, carbs:96, fiber:18}, L:{kcal:1019, protein:54, fat:47, carbs:105, fiber:19} } },
            { category: 'DRYKKIR', theme: 'STRENGTH', nameIs: 'Berjabomba', nameEn: 'Berry Bomb', descriptionIs: 'Hindber, bláber, ólífuolía, kókosmjólk og prótein.', prices: {S:'1.390 kr', M:'1.590 kr', L:'1.690 kr'}, macros: { S:{kcal:779, protein:24, fat:68, carbs:22, fiber:5}, M:{kcal:865, protein:28, fat:75, carbs:24, fiber:5}, L:{kcal:951, protein:30, fat:83, carbs:27, fiber:6} } },
            { category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Kraftur', nameEn: 'Power', descriptionIs: 'Vanillu skyr, banani, jarðarber og prótein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:308, protein:38, fat:1, carbs:37, fiber:4}, M:{kcal:333, protein:40, fat:1, carbs:41, fiber:4}, L:{kcal:354, protein:42, fat:1, carbs:44, fiber:4} } },
            { category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Prótein ískaffi', nameEn: 'Protein Iced Coffee', descriptionIs: 'Tvöfaldur espresso, möndlumjólk, ólífuolía og prótein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:180, protein:28, fat:9, carbs:4, fiber:0}, M:{kcal:200, protein:30, fat:10, carbs:4, fiber:0}, L:{kcal:220, protein:32, fat:11, carbs:4, fiber:0} } },
            { category: 'DRYKKIR', theme: 'ENERGY', nameIs: 'Snerpa', nameEn: 'Vigor', descriptionIs: 'Jarðarber, banani, epli og Amino Energy.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:142, protein:1, fat:1, carbs:44, fiber:4}, M:{kcal:157, protein:2, fat:1, carbs:39, fiber:4}, L:{kcal:173, protein:2, fat:1, carbs:43, fiber:4} }, isVegan: true },
            { category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Græn heilsa', nameEn: 'Green Health', descriptionIs: 'Spínat, mangó, epli, sellerí og collagen.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:232, protein:28, fat:1, carbs:31, fiber:7}, M:{kcal:258, protein:31, fat:1, carbs:35, fiber:8}, L:{kcal:283, protein:34, fat:1, carbs:38, fiber:9} } },
            { category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Brennsla', nameEn: 'Metabolism', descriptionIs: 'Epli, mangó, bláber, engifer og prótein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:283, protein:23, fat:2, carbs:44, fiber:6}, M:{kcal:300, protein:26, fat:2, carbs:49, fiber:7}, L:{kcal:347, protein:29, fat:2, carbs:54, fiber:8} } },
            { category: 'DRYKKIR', theme: 'LIGHT', nameIs: 'Upphitun', nameEn: 'Warm-up', descriptionIs: 'Vanillu skyr, jarðarber, mangó og ananas.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:177, protein:11, fat:2, carbs:31, fiber:3}, M:{kcal:197, protein:12, fat:3, carbs:34, fiber:3}, L:{kcal:217, protein:13, fat:3, carbs:37, fiber:3} } },
            { category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Gleði', nameEn: 'Joy', descriptionIs: 'Sítróna, engifer, jarðarber, epli og jarðarberjaprótein.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:232, protein:24, fat:2, carbs:33, fiber:5}, M:{kcal:258, protein:27, fat:2, carbs:37, fiber:6}, L:{kcal:283, protein:29, fat:2, carbs:41, fiber:6} } },
            { category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Líf', nameEn: 'Life', descriptionIs: 'Avókadó, epli, ananas og engifer.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:365, protein:4, fat:18, carbs:56, fiber:15}, M:{kcal:406, protein:4, fat:19, carbs:62, fiber:16}, L:{kcal:447, protein:5, fat:22, carbs:69, fiber:18} }, isVegan: true },
            { category: 'DRYKKIR', theme: 'BALANCE', nameIs: 'Endurnýjun', nameEn: 'Renewal', descriptionIs: 'Rauðrófusafi, avókadó, sellerí, epli og sítróna.', prices: {S:'1.290 kr', M:'1.490 kr', L:'1.590 kr'}, macros: { S:{kcal:324, protein:6, fat:18, carbs:44, fiber:13}, M:{kcal:360, protein:7, fat:20, carbs:49, fiber:14}, L:{kcal:396, protein:7, fat:22, carbs:53, fiber:15} }, isVegan: true },
            { category: 'SALAT', theme: 'STRENGTH', nameIs: 'Strength Salat', nameEn: 'Strength Salad', price: '2.190 kr', descriptionIs: 'Kjúklingur, pasta, vínber, döðlur, parmesanostur.', macros: { kcal: 905, protein: 57, fat: 33, carbs: 98, fiber: 13 } },
            { category: 'SALAT', theme: 'ENERGY', nameIs: 'Energy Salat', nameEn: 'Energy Salad', price: '2.190 kr', descriptionIs: 'Pestó pasta, tómatar, spínat, döðlur, kasjúhnetur og fetaostur.', macros: { kcal: 991, protein: 32, fat: 49, carbs: 102, fiber: 17 } },
            { category: 'SALAT', theme: 'LIGHT', nameIs: 'Light Salat', nameEn: 'Light Salad', price: '1.890 kr', descriptionIs: 'Salat, túnfiskur, egg, rauðlaukur, gúrka og kotasæludressing.', macros: { kcal: 452, protein: 49, fat: 17, carbs: 15, fiber: 4 } },
            { category: 'SALAT', theme: 'BALANCE', nameIs: 'Balance Salat', nameEn: 'Balance Salad', price: '2.190 kr', descriptionIs: 'Salat, grænmetisbuff, avocado, rauðlaukur, gúrka, tómatar.', macros: { kcal: 539, protein: 11, fat: 38, carbs: 42, fiber: 10 }, isVegan: true },
            { category: 'GRAUTUR', theme: 'STRENGTH', nameIs: 'Strength Grautur', nameEn: 'Strength Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og vanillu prótein.', macros: { kcal: 731, protein: 44, fat: 14, carbs: 115, fiber: 16 } },
            { category: 'GRAUTUR', theme: 'ENERGY', nameIs: 'Energy Grautur', nameEn: 'Energy Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og Cookies & Cream prótein.', macros: { kcal: 720, protein: 42, fat: 13, carbs: 110, fiber: 12 } },
            { category: 'GRAUTUR', theme: 'LIGHT', nameIs: 'Light Grautur', nameEn: 'Light Porridge', price: '890 kr', descriptionIs: 'Möndlumjólk, hafrar og hunang.', macros: { kcal: 524, protein: 16, fat: 15, carbs: 87, fiber: 12 } },
            { category: 'GRAUTUR', theme: 'BALANCE', nameIs: 'Balance Grautur', nameEn: 'Balance Porridge', price: '990 kr', descriptionIs: 'Möndlumjólk, hafrar, hunang og collagen.', macros: { kcal: 680, protein: 42, fat: 8, carbs: 113, fiber: 13 } },
            { category: 'KRISP', theme: 'STRENGTH', nameIs: 'Túnfisk & Egg Krisp', nameEn: 'Tuna & Egg Crisp', price: '1.290 kr', descriptionIs: '4x Finn Crisp og túnfisksalat.', macros: { kcal: 313, protein: 32, fat: 16, carbs: 17, fiber: 5 } },
            { category: 'KRISP', theme: 'ENERGY', nameIs: 'Kjúklinga Avocado Krisp', nameEn: 'Chicken Avocado Crisp', price: '1.290 kr', descriptionIs: '4x Finn Crisp, kjúklingur, avókadó og sesamfræ.', macros: { kcal: 290, protein: 23, fat: 15, carbs: 22, fiber: 7 } },
            { category: 'KRISP', theme: 'LIGHT', nameIs: 'Kjúklinga Krisp', nameEn: 'Chicken Crisp', price: '1.190 kr', descriptionIs: '4x Finn Crisp, kjúklingasalat og tómatar.', macros: { kcal: 288, protein: 29, fat: 13, carbs: 15, fiber: 4 } },
            { category: 'KRISP', theme: 'BALANCE', nameIs: 'Hummus Krisp', nameEn: 'Hummus Crisp', price: '1.190 kr', descriptionIs: '4x Finn Crisp, hummus og tómatar.', macros: { kcal: 263, protein: 11, fat: 8, carbs: 50, fiber: 19 }, isVegan: true },
            { category: 'SKOT', theme: 'ALL', nameIs: 'Engifer Skot', nameEn: 'Ginger Shot', price: '450 kr', descriptionIs: 'Ferskt engifer og sítróna.', macros: { kcal: 15, protein: 0.5, fat: 0, carbs: 3, fiber: 0.5 }, isVegan: true },
            { category: 'SKOT', theme: 'ALL', nameIs: 'Túrmerik Skot', nameEn: 'Turmeric Shot', price: '450 kr', descriptionIs: 'Túrmerik, epli og engifer.', macros: { kcal: 20, protein: 0.5, fat: 0, carbs: 4.5, fiber: 0.5 }, isVegan: true },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Harðfiskur', nameEn: 'Dried Fish', price: '990 kr', descriptionIs: 'Hágæða íslenskur harðfiskur.', macros: { kcal: 320, protein: 78, fat: 1, carbs: 0, fiber: 0 } },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Prótein muffins', nameEn: 'Protein Muffin', price: '590 kr', descriptionIs: 'Próteinrík muffins-kaka.', macros: { kcal: 240, protein: 18, fat: 8, carbs: 22, fiber: 4 } },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Hnetumix', nameEn: 'Nut Mix', price: '390 kr', descriptionIs: 'Blanda af völdum hnetum.', macros: { kcal: 180, protein: 8, fat: 14, carbs: 12, fiber: 3 }, isVegan: true },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Egg', nameEn: 'Egg', price: '250 kr', descriptionIs: 'Eitt soðið egg.', macros: { kcal: 78, protein: 6, fat: 5, carbs: 1, fiber: 0 } },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Epli', nameEn: 'Apple', price: '150 kr', descriptionIs: 'Ferskt epli.', isVegan: true },
            { category: 'GRÍPTU MEÐ', theme: 'ALL', nameIs: 'Banani', nameEn: 'Banana', price: '170 kr', descriptionIs: 'Ferskur banani.', isVegan: true }
        ];

        let lastAnimatedMacros = { kcal: 0, protein: 0, fat: 0, carbs: 0, fiber: 0 };
        let state = { isIcelandic: true, viewMode: 'categories', activeCategory: 'DRYKKIR', activeTheme: null, selectedSize: 'M', sortBy: 'category' };
        
        const getLang = () => state.isIcelandic ? IS_LANG : EN_LANG;

        function scrollToContent() {
            const anchor = document.getElementById('scroll-anchor');
            if (anchor) {
                setTimeout(() => {
                    const topOffset = anchor.getBoundingClientRect().top + window.pageYOffset;
                    window.scrollTo({
                        top: topOffset,
                        behavior: 'smooth'
                    });
                }, 100);
            }
        }

        function triggerNudgeIfScrollable() {
            const nav = document.getElementById('category-tabs');
            if (nav && nav.scrollWidth > nav.clientWidth) {
                nav.classList.remove('nudge-effect');
                void nav.offsetWidth;
                nav.classList.add('nudge-effect');
            }
        }

        function toggleLanguage() {
            state.isIcelandic = !state.isIcelandic;
            updateFlagAndLabel();
            render();
        }

        function updateFlagAndLabel() {
            document.getElementById('lang-flag-img').src = state.isIcelandic ? "https://flagcdn.com/w80/is.png" : "https://flagcdn.com/w80/gb.png";
        }

        function setViewMode(mode) {
            state.viewMode = mode;
            if (mode === 'categories') { state.activeTheme = null; state.activeCategory = 'DRYKKIR'; }
            else { state.activeCategory = null; state.activeTheme = 'LIGHT'; }
            render();
            scrollToContent();
            setTimeout(triggerNudgeIfScrollable, 400);
        }

        function setSort(type) { state.sortBy = type; render(); }

        function render() {
            const lang = getLang();
            document.getElementById('tagline').textContent = lang.tagline;
            document.getElementById('sort-label').textContent = lang.labelSortBy;
            document.getElementById('mode-categories').textContent = lang.labelCat;
            document.getElementById('mode-themes').textContent = lang.labelGoals;
            document.querySelectorAll('.view-toggle-btn').forEach(btn => btn.classList.toggle('active', btn.id === `mode-${state.viewMode}`));
            document.getElementById('category-container').classList.toggle('hidden', state.viewMode !== 'categories');
            document.getElementById('theme-container').classList.toggle('hidden', state.viewMode !== 'themes');
            renderNav();
            renderThemeButtons();
            renderHero();
            renderGrid();
        }

        function renderNav() {
            const container = document.getElementById('category-tabs');
            container.innerHTML = Object.entries(CATEGORIES).map(([key, info]) => {
                const active = state.activeCategory === key;
                return `<button onclick="state.activeCategory='${key}';render();scrollToContent()" class="category-tab transition-all duration-300 ${active ? 'active-tab' : 'text-gray-400 hover:text-gray-600'}">${state.isIcelandic ? info.is : info.en}</button>`;
            }).join('');
        }

        function renderThemeButtons() {
            const container = document.getElementById('theme-container');
            const sortedThemes = ['LIGHT', 'BALANCE', 'ENERGY', 'STRENGTH'];
            container.innerHTML = sortedThemes.map(key => {
                const t = THEMES[key];
                const active = state.activeTheme === t.key;
                return `<button onclick="state.activeTheme='${t.key}';render();scrollToContent()" class="theme-btn text-left p-4 rounded-3xl flex items-start gap-3 bg-white border border-gray-100 ${active ? 'ring-2 ring-offset-2 ring-red-500 shadow-lg' : ''}" style="color:${t.color}"><div class="w-2.5 h-2.5 rounded-full mt-1 flex-shrink-0" style="background-color:${t.color}"></div><div><h5 class="text-[9px] font-black uppercase tracking-widest leading-none mb-1 text-gray-900">${state.isIcelandic ? t.is : t.en}</h5><p class="text-[8px] text-gray-400 leading-tight">${state.isIcelandic ? t.descIs : t.descEn}</p></div></button>`;
            }).join('');
        }

        function renderHero() {
            const hero = document.getElementById('category-hero');
            const heroImg = document.getElementById('hero-img');
            const heroTitle = document.getElementById('hero-title');
            const overlay = document.getElementById('hero-color-overlay');
            let newSrc = "", newTitle = "", newColor = "", newOpacity = "0";
            if (state.viewMode === 'themes' && state.activeTheme) {
                const t = THEMES[state.activeTheme];
                newSrc = "https://images.prismic.io/worldclass/aVxTO3NYClf9ozUE_menu1920.jpg";
                newTitle = state.isIcelandic ? t.is : t.en;
                newColor = t.color; newOpacity = '0.5';
            } else if (state.viewMode === 'categories' && state.activeCategory) {
                const c = CATEGORIES[state.activeCategory];
                newSrc = c.img; newTitle = state.isIcelandic ? c.is : c.en;
            }
            if (newSrc) { hero.classList.remove('hidden'); heroImg.src = newSrc; heroTitle.textContent = newTitle; overlay.style.backgroundColor = newColor; overlay.style.opacity = newOpacity; }
            else { hero.classList.add('hidden'); }
        }

        function renderGrid() {
            const container = document.getElementById('menu-grid');
            const lang = getLang();
            let items = [...rawData];
            
            if (state.viewMode === 'themes' && state.activeTheme) {
                items = items.filter(i => i.theme === state.activeTheme || i.theme === 'ALL');
            } else if (state.viewMode === 'categories' && state.activeCategory) {
                items = items.filter(i => i.category === state.activeCategory);
            }

            const macroKeys = ['kcal', 'protein', 'carbs', 'fat'];
            
            if (macroKeys.includes(state.sortBy)) {
                items.sort((a, b) => {
                    const getVal = (item) => {
                        const m = item.macros ? (item.prices ? item.macros.M : item.macros) : null;
                        return m ? (m[state.sortBy] || 0) : 0;
                    };
                    return getVal(a) - getVal(b);
                });
            } else {
                items.sort((a, b) => {
                    if (state.viewMode === 'themes') {
                        const categoryOrder = ['DRYKKIR', 'SALAT', 'GRAUTUR', 'KRISP', 'SKOT', 'BÖRN', 'KAFFI', 'GRÍPTU MEÐ'];
                        const aIdx = categoryOrder.indexOf(a.category);
                        const bIdx = categoryOrder.indexOf(b.category);
                        if (aIdx !== bIdx) return aIdx - bIdx;
                    } else {
                        const themeOrder = ['LIGHT', 'BALANCE', 'ENERGY', 'STRENGTH'];
                        const aIdx = themeOrder.indexOf(a.theme);
                        const bIdx = themeOrder.indexOf(b.theme);
                        if (aIdx !== bIdx) return aIdx - bIdx;
                    }
                    return a.nameIs.localeCompare(b.nameIs);
                });
            }

            document.querySelectorAll('.sort-btn').forEach(b => {
                const isActive = b.id === `sort-${state.sortBy}`;
                if (isActive) {
                    b.classList.remove('bg-white', 'text-gray-500', 'border-gray-200');
                    b.classList.add('bg-gray-900', 'text-white', 'border-gray-900');
                } else {
                    b.classList.add('bg-white', 'text-gray-500', 'border-gray-200');
                    b.classList.remove('bg-gray-900', 'text-white', 'border-gray-900');
                }
            });

            if (items.length === 0) { container.innerHTML = `<div class="col-span-full py-20 text-center text-gray-300 font-bold uppercase tracking-widest">${lang.noResults}</div>`; return; }
            
            container.innerHTML = items.map((item) => {
                const theme = THEMES[item.theme] || { is: 'Standard', en: 'Standard', color: '#9ca3af' };
                const price = item.prices ? item.prices.M : item.price;
                const m = item.macros ? (item.prices ? item.macros.M : item.macros) : null;
                let sortBadge = "";
                if (m && macroKeys.includes(state.sortBy)) {
                    const val = Math.round(m[state.sortBy]);
                    const unit = state.sortBy === 'kcal' ? 'kcal' : 'g';
                    sortBadge = `<div class="bg-gray-50 text-gray-400 text-[8px] font-bold px-2 py-0.5 rounded-md uppercase tracking-widest border border-gray-100">${val}${unit} ${lang[state.sortBy]}</div>`;
                }
                return `<div class="item-card bg-white p-7 rounded-[2.2rem] border border-gray-50 shadow-sm cursor-pointer animate-slide-up" onclick="openModal(${rawData.indexOf(item)})">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex flex-row flex-wrap gap-1.5 max-w-[70%]">
                            <span class="text-[8px] font-black px-2 py-0.5 rounded-md text-white uppercase tracking-widest w-fit" style="background-color: ${theme.color}">${state.isIcelandic ? theme.is : theme.en}</span>
                            ${sortBadge}
                            ${item.isVegan ? '<span class="text-[8px] font-black px-2 py-0.5 rounded-md bg-green-500/10 text-green-600 uppercase tracking-widest border border-green-500/20 w-fit">Vegan</span>' : ''}
                        </div>
                        <span class="text-base font-black text-red-500 tracking-tight block leading-none">${price || ''}</span>
                    </div>
                    <h3 class="text-lg font-black text-gray-900 mb-2 tracking-tight leading-tight">${state.isIcelandic ? item.nameIs : item.nameEn}</h3>
                    <p class="text-gray-400 text-xs leading-relaxed line-clamp-2 font-medium">${state.isIcelandic ? item.descriptionIs : item.descriptionEn}</p>
                </div>`;
            }).join('');
        }

        function animateSynchronized(targetMacros) {
            const start = { ...lastAnimatedMacros };
            const end = { 
                kcal: targetMacros.kcal || 0,
                protein: targetMacros.protein || 0,
                carbs: targetMacros.carbs || 0,
                fat: targetMacros.fat || 0,
                fiber: targetMacros.fiber || 0
            };
            const circ = 408.4; 
            const duration = 1200; 
            const elements = { 
                protein: document.getElementById('circle-protein'), 
                carbs: document.getElementById('circle-carbs'), 
                fat: document.getElementById('circle-fat'), 
                valK: document.getElementById('val-kcal-center')
            };
            let startTime = null;
            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const ease = progress < 0.5 ? 2 * progress * progress : -1 + (4 - 2 * progress) * progress;
                const currentKcal = Math.round(start.kcal + (end.kcal - start.kcal) * ease);
                if (elements.valK) elements.valK.textContent = currentKcal;
                ['protein', 'carbs', 'fat', 'fiber'].forEach(key => {
                    const el = document.getElementById(`val-${key}`);
                    if (el) {
                        const val = Math.round(start[key] + (end[key] - start[key]) * ease);
                        el.textContent = `${val}g`;
                    }
                });
                const p = start.protein + (end.protein - start.protein) * ease;
                const c = start.carbs + (end.carbs - start.carbs) * ease;
                const f = start.fat + (end.fat - start.fat) * ease;
                const total = p + c + f || 1;
                const ratios = { p: p/total, c: c/total, f: f/total };
                const isInitial = start.protein === 0 && start.carbs === 0 && start.fat === 0;
                const fillFactor = isInitial ? ease : 1;
                elements.protein.style.strokeDashoffset = circ - (ratios.p * fillFactor * circ);
                elements.carbs.style.strokeDashoffset = circ - (ratios.c * fillFactor * circ);
                elements.fat.style.strokeDashoffset = circ - (ratios.f * fillFactor * circ);
                elements.protein.style.transform = 'rotate(0deg)';
                elements.carbs.style.transform = `rotate(${ratios.p * fillFactor * 360}deg)`;
                elements.fat.style.transform = `rotate(${(ratios.p + ratios.c) * fillFactor * 360}deg)`;
                if (progress < 1) { requestAnimationFrame(step); } else { lastAnimatedMacros = { ...end }; }
            }
            requestAnimationFrame(step);
        }

        function openModal(idx) {
            const item = rawData[idx]; state.modalItem = item; state.selectedSize = item.prices ? 'M' : null;
            lastAnimatedMacros = { kcal: 0, protein: 0, fat: 0, carbs: 0, fiber: 0 };
            const theme = THEMES[item.theme] || { is: 'Standard', en: 'Standard', color: '#9ca3af' };
            const themeTag = document.getElementById('modal-tag');
            themeTag.textContent = state.isIcelandic ? theme.is : theme.en;
            themeTag.style.backgroundColor = theme.color;
            document.getElementById('modal-title').textContent = state.isIcelandic ? item.nameIs : item.nameEn;
            document.getElementById('modal-description').textContent = state.isIcelandic ? item.descriptionIs : item.descriptionEn;
            updateModalUI();
            const modal = document.getElementById('item-modal');
            const content = document.getElementById('modal-content');
            modal.classList.replace('hidden', 'flex');
            setTimeout(() => {
                content.classList.replace('scale-95', 'scale-100');
                content.classList.replace('opacity-0', 'opacity-100');
                const m = item.macros ? (item.prices ? item.macros[state.selectedSize] : item.macros) : null;
                if (m) animateSynchronized(m);
            }, 50);
        }

        function updateModalUI() {
            const item = state.modalItem; const lang = getLang(); const m = item.macros ? (item.prices ? item.macros[state.selectedSize] : item.macros) : null;
            const pCont = document.getElementById('modal-price-container'); const mCont = document.getElementById('modal-macros');
            pCont.innerHTML = item.prices ? `<div class="grid grid-cols-3 gap-2">${Object.entries(item.prices).map(([s, p]) => `<button onclick="state.selectedSize='${s}';updateModalUI();triggerSizeTransition()" class="flex flex-col items-center py-2.5 rounded-2xl border transition-all ${state.selectedSize===s?'border-red-400 bg-red-50 text-red-500 font-black shadow-inner':'border-gray-100 text-gray-400'}"><span class="text-[8px] font-black uppercase mb-0.5">${lang[s]}</span><span class="text-xs font-bold">${p}</span></button>`).join('')}</div>` : `<span class="text-2xl font-black text-red-500 tracking-tighter">${item.price || ''}</span>`;
            
            if (m) {
                document.getElementById('modal-nutrition-section').classList.remove('hidden');
                // Samkvæmt image_36a9f4.png: Örsmá heiti, mýkri tölur, breiðari kassar
                const rows = [ 
                    {k:'protein', c:'text-[#dc2626]', bg:'bg-[#fff1f2]'}, 
                    {k:'carbs', c:'text-[#ea580c]', bg:'bg-[#fff7ed]'},   
                    {k:'fat', c:'text-[#0284c7]', bg:'bg-[#f0f9ff]'},     
                    {k:'fiber', c:'text-[#16a34a]', bg:'bg-[#f0fdf4]'}    
                ];
                mCont.innerHTML = rows.map(r => `
                    <div class="${r.bg} px-6 py-2 rounded-2xl flex items-center justify-between border border-white/50 shadow-sm w-full">
                        <span class="text-[7px] font-black uppercase tracking-[0.2em] ${r.c}">${lang[r.k]}</span>
                        <span id="val-${r.k}" class="text-base font-black text-gray-800">0g</span>
                    </div>`).join('');
            } else { document.getElementById('modal-nutrition-section').classList.add('hidden'); }
        }

        function triggerSizeTransition() {
            const item = state.modalItem;
            const m = item.macros ? (item.prices ? item.macros[state.selectedSize] : item.macros) : null;
            if (m) animateSynchronized(m);
        }

        async function shareAsImage() {
            const container = document.getElementById('export-container');
            const logo = document.getElementById('export-logo');
            const hiddenElements = document.querySelectorAll('.export-hide');
            const shareBtn = document.getElementById('share-img-btn');
            shareBtn.disabled = true;
            logo.classList.replace('hidden', 'block');
            hiddenElements.forEach(el => el.style.display = 'none');
            try {
                const canvas = await html2canvas(container, { backgroundColor: "#ffffff", scale: 3, useCORS: true, logging: false, onclone: (clonedDoc) => {
                    const el = clonedDoc.getElementById('export-container');
                    el.style.borderRadius = "2.5rem";
                    el.style.padding = "32px";
                }});
                const roundedCanvas = document.createElement('canvas');
                const ctx = roundedCanvas.getContext('2d');
                const radius = 100;
                roundedCanvas.width = canvas.width; roundedCanvas.height = canvas.height;
                ctx.beginPath(); ctx.moveTo(radius, 0); ctx.lineTo(canvas.width - radius, 0); ctx.quadraticCurveTo(canvas.width, 0, canvas.width, radius); ctx.lineTo(canvas.width, canvas.height - radius); ctx.quadraticCurveTo(canvas.width, canvas.height, canvas.width - radius, canvas.height); ctx.lineTo(radius, canvas.height); ctx.quadraticCurveTo(0, canvas.height, 0, canvas.height - radius); ctx.lineTo(0, radius); ctx.quadraticCurveTo(0, 0, radius, 0); ctx.closePath(); ctx.clip(); ctx.drawImage(canvas, 0, 0);
                const fileName = `${state.modalItem.nameIs || 'laugar-cafe'}.png`;
                if (navigator.canShare && navigator.share) {
                    roundedCanvas.toBlob(async (blob) => {
                        const file = new File([blob], fileName, { type: 'image/png' });
                        try { await navigator.share({ files: [file], title: state.modalItem.nameIs, text: 'Skoðaðu þennan rétt hjá Laugar Cafe!' }); }
                        catch (err) { if (err.name !== 'AbortError') triggerDownloadFallback(roundedCanvas, fileName); }
                    }, 'image/png');
                } else { triggerDownloadFallback(roundedCanvas, fileName); }
            } catch (err) { console.error(err); } finally {
                logo.classList.replace('block', 'hidden'); hiddenElements.forEach(el => el.style.display = ''); shareBtn.disabled = false;
            }
        }

        function triggerDownloadFallback(canvas, fileName) {
            const link = document.createElement('a'); link.download = fileName; link.href = canvas.toDataURL('image/png', 1.0); link.click();
        }

        function closeModal() { 
            const c = document.getElementById('modal-content'); 
            c.classList.replace('scale-100', 'scale-95'); 
            c.classList.replace('opacity-100', 'opacity-0'); 
            setTimeout(() => document.getElementById('item-modal').classList.replace('flex', 'hidden'), 300); 
        }

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');
            if (langParam && langParam.toLowerCase() === 'en') { state.isIcelandic = false; }
            updateFlagAndLabel();
            render();
            setTimeout(triggerNudgeIfScrollable, 1000);
        };
    </script>
</body>
</html>
